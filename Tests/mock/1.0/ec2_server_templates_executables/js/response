HTTP/1.1 200 OK
Server: nginx/1.0.14
Date: Wed, 11 Apr 2012 05:00:00 GMT
Content-Type: text/javascript; charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive
Vary: Accept-Encoding
Vary: Accept-Encoding
Status: 200
X-Powered-By: Phusion Passenger (mod_rails/mod_rack) 3.0.11
X-Runtime: 45
Set-Cookie: _session_id=7eb4fd2549e4702aee20b3741f96237d; path=/; Secure; HttpOnly
Cache-Control: private, max-age=0, must-revalidate
Content-Encoding: gzip

[{"right_script":{"is_head_version":false,"href":"https://my.rightscale.com/api/acct/12345/right_scripts/12345","version":1,"script":"#!/bin/bash -ex\n#\n# Copyright (c) 2008-2011 RightScale, Inc, All Rights Reserved Worldwide.\n#\n\n#\n# Test for a reboot,  if this is a reboot just skip this script.\n#\nif test \"$RS_REBOOT\" = \"true\" ; then\n  echo \"Skip re-setting Timezone on reboot.\"\n  exit 0 # Leave with a smile ...\nfi\n\n#\n# If this parameter is not set leave unchanged and use localtime\n#\nif [ \"$SYS_TZINFO\" = \"localtime\" ]; then\n  echo \"SYS_TZINFO set to localtime.  Not changing /etc/localtime...\"\n  exit 0\nelse\n  tzset=\"$SYS_TZINFO\"\nfi\n\n#\n# Set the Timezone\n#\nln -sf /usr/share/zoneinfo/$tzset /etc/localtime\necho \"Timezone set to $tzset\"\n\nlogger -t RightScale \"Timezone set to $tzset\"\n\nexit 0\n","name":"SYS Timezone set - 12H1.rc","created_at":"2012/03/27 20:33:54 +0000","updated_at":"2012/03/27 20:33:55 +0000","description":"Sets the server timezone.\n\n**Launch**\n\nUpdates the timezone to the one specified in the SYS\\_TZINFO input variable selected from the pull-down menu.  If \"localtime\" is selected then the timezone will not be changed from the current/installed setting.\n\n**Reboot**\n\nNo actions are taken.  If you have changed the value it will remain set to your selection.\n\n**Operation Script**\n\nWill change the timezone setting to the value of SYS\\_TZINFO"},"apply":"boot","recipe":null,"position":1},{"right_script":{"is_head_version":false,"href":"https://my.rightscale.com/api/acct/12345/right_scripts/12345","version":10,"script":"#!/bin/bash -ex\n# Copyright (c) 2007-2011 by RightScale Inc., all rights reserved\n\nset +e\nwhich rs_tag\nif [ \"$?\" -ne 0 ]; then\n  logger -s -t RightScale \"FATAL ERROR: this RightScript only supports v5 based RightImages that have rs_tag support!  You must use SYS Syslog Remote Logging Client v7 instead if you are using a v4 RightImage\"\n  exit 1\nfi\nset -e\n\n# Auto-gernerate config file\nfunction write_config\n{\n  [ -e /etc/syslog-ng/syslog-ng.conf ] && mv -f /etc/syslog-ng/syslog-ng.conf /etc/syslog-ng/syslog-ng.conf.bak.$(date \"+%Y%m%d%H%M%S\")\n  cp $RS_ATTACH_DIR/syslog-ng-remote.conf /etc/syslog-ng/syslog-ng.conf\n  if [[ \"$RS_DISTRO\" == ubuntu ]]; then\n    cat >> /etc/syslog-ng/syslog-ng.conf <<EOF\ndestination df_syslog { file(\"/var/log/syslog\"); };\n\n# all messages except from the auth and authpriv facilities\nfilter f_syslog { not facility(auth, authpriv); };\n\n# *.*;auth,authpriv.none          -/var/log/syslog\nlog {\n        source(s_sys);\n        filter(f_syslog);\n        destination(df_syslog);\n};\nEOF\n  fi\n  #Inject Instance ID into config\n  perl -p -i -e 's/i-123456/'$SERVER_UUID'/' /etc/syslog-ng/syslog-ng.conf\n  #set syslog server. \n  perl -p -i -e 's/syslog.rightscale.com/'$SYSLOG_SERVER'/' /etc/syslog-ng/syslog-ng.conf\n  # Set apache log dir (for haproxy.log)\n  sed -i \"/@@APACHE_LOG_DIR@@/s//$apache_log_dir/\" /etc/syslog-ng/syslog-ng.conf\n  #\n  # Remote syslog is not currently supported on the any cloud other than ec2 cloud,\n  # so instead redirect all logging over UDP to /var/log/messages.\n  #\n  # RS_CLOUD_PROVIDER is not defined yet for all clouds - check for existence so we\n  # can get cloud.com going.\n  # Ticket #s-8736\n  #\n  if [ -z \"$RS_CLOUD_PROVIDER\" -o \"$RS_CLOUD_PROVIDER\" != \"ec2\" ]; then\n    sed -i 's/^destination d_udp .*$/destination d_udp { file(\"\\/dev\\/null.syslog-ng\"); };/' /etc/syslog-ng/syslog-ng.conf\n  fi\n}\n\ncase \"$RS_DISTRO\" in\n  ubuntu)\n    logrotate_file=/etc/logrotate.d/syslog-ng\n    apache_log_dir=apache2\n    ;;\n  centos|redhat*)\n    logrotate_file=/etc/logrotate.d/syslog\n    apache_log_dir=httpd\n    ;;\n  *)\n    logger -s -t RightScale \"RS_DIST ($RS_DISTRO) is not supported at this time. exiting...\"\n    exit 1\n    ;;\nesac\n\n# Test for a reboot,  if this is a reboot just update config.\n#\n# Test if this script has already run.  If so it is either a boot script being re-run\n# or the server is being started from a stopped state.  Update the config - same as reboot.\n#\nif test \"$RS_REBOOT\" = \"true\" -o \"$RS_ALREADY_RUN\" = \"true\"; then\n  logger -s -t RightScale \"Update SYSLOG configuration on reboot or start.\"\n  write_config\n  service syslog-ng restart\n  # Tag instance for start/stop support\n  rs_tag -a \"rs_logging:state=active\" && logger -s -t RightScale \"Setting logging active tag\"\n  logger -t RightScale \"Updated SYSLOG configuration on reboot or start.\"\n  exit 0\nfi\n\n#create a new /dev/null for syslog-ng to use\n#\nif [ ! -e /dev/null.syslog-ng ]; then\n  mknod /dev/null.syslog-ng c 1 3\nfi\n\nwrite_config\nservice syslog-ng restart\n\n# Set up log file rotation\nperl -p -i -e 's/weekly/daily/; s/rotate\\s+\\d+/rotate 7/' /etc/logrotate.conf\n\n# fix /var/log/boot.log issue\n[ ! -e /var/log/boot.log ] && touch /var/log/boot.log\n\n[ -z \"$(grep -lir \"missingok\" $logrotate_file)\" ] && sed -i '/sharedscripts/ a\\    missingok' $logrotate_file\n[ -z \"$(grep -lir \"notifempty\" $logrotate_file)\" ] && sed -i '/sharedscripts/ a\\    notifempty' $logrotate_file\n\n# tag required for RightLink enabled images\nrs_tag -a \"rs_logging:state=active\" && logger -s -t RightScale \"Setting logging active tag\"\n","name":"SYS Syslog remote logging client - 12H1.rc","created_at":"2012/03/27 20:33:55 +0000","updated_at":"2012/03/27 20:33:55 +0000","description":"Configures syslog-ng for remote logging on the RightScale syslog servers.\n\n"},"apply":"boot","recipe":null,"position":2},{"right_script":{"is_head_version":false,"href":"https://my.rightscale.com/api/acct/12345/right_scripts/12345","version":5,"script":"#!/bin/bash -ex\n#\n# Copyright (c) 2008-2011 RightScale, Inc, All Rights Reserved Worldwide.\n#\n\npostfix_file=/etc/postfix/main.cf\nbackupfile_time=`date +%H%M%S`\ncp $postfix_file $postfix_file.$backupfile_time\n\nif [  \"$RS_DISTRO\" ==  \"ubuntu\" ]; then\n  logger -s -t RightScale \"Using Ubuntu default main.cf config\"\nelse\n# Make the changes needed for centos\nsed -i 's/inet_interfaces = localhost/#inet_interfaces = localhost/' $postfix_file\nsed -i 's/#inet_interfaces = all/inet_interfaces = all/' $postfix_file\n\n# Replace everything after the localhost.  This assumes that the last host entry is\n# The host that this script added.  If there are other hosts added to this line by\n# some other script then this will break.  A specialized script must be written to\n# handle this case.\nfqdn=`hostname -f`\nlogger -s -t RightScale 'Adding $fqdn to postfix destinations.'\nsed -i \"s/^mydestination = \\$myhostname\\, localhost\\.\\$mydomain\\, localhost.*$/mydestination = \\$myhostname, localhost\\.\\$mydomain\\, localhost\\, $fqdn/\" $postfix_file\n\n# Must restart to change inet settings.\nservice postfix restart\n\nfi","name":"MAIL Postfix local delivery - 12H1.rc","created_at":"2012/03/27 20:33:47 +0000","updated_at":"2012/03/27 20:33:47 +0000","description":"Configures postfix to deliver local mail by accepting SMTP connections on localhost.\n"},"apply":"boot","recipe":null,"position":3},{"right_script":{"is_head_version":false,"href":"https://my.rightscale.com/api/acct/12345/right_scripts/12345","version":10,"script":"#!/bin/bash -ex\n# Copyright (c) 2007-2011 by RightScale Inc., all rights reserved\n\n#### Check if supported on image ####\n\nset +e\nwhich rs_tag\nif [ \"$?\" -ne 0 ]; then\n  logger -s -t RightScale \"FATAL ERROR: this RightScript only supports v5 based RightImages that have rs_tag support!  You must use SYS Monitoring install v8 instead if you are using a v4 RightImage\"\n  exit 1\nfi\nset -e\n\n\n#### Setup Distro dependent variables ####\npackage_comment=\"\\n#RightScale: do not allow collectd version to be modified.\\n#Collectd packages handled by SYS Monitoring install rightscript\"\n\ncase \"$RS_DISTRO\" in\n  ubuntu)\n    config=\"/etc/collectd/collectd.conf\"\n    plugin_dir=\"/etc/collectd/conf\"\n    cron_service=cron\n    apt_preferences_config=/etc/apt/preferences.d/12345rightscale\n    ;;\n  centos|redhat*)\n    config=\"/etc/collectd.conf\"\n    plugin_dir=\"/etc/collectd.d\"\n    cron_service=crond\n    yum_epel_config=/etc/yum.repos.d/Epel.repo\n    ;;\n  *)\n    logger -s -t RightScale \"RS_DIST ($RS_DISTRO) is not supported at this time. exiting...\"\n    exit 1\n    ;;\nesac\nmkdir -p $plugin_dir\n\n# Auto-generate config file\nfunction write_config \n{\n  [ -e $config ] && mv -f $config ${config}.bak.$(date \"+%Y%m%d%H%M%S\")\n  cp -f $RS_ATTACH_DIR/collectd-client.conf $config\n  sed -i -e \"s/^Hostname.*/Hostname \\\"$SERVER_UUID\\\"/\" $config\n  [ -n \"$SKETCHY\" ] && sed -i -e \"s/sketchy\\.rightscale\\.com/$SKETCHY/\" $config\n  [ \"$(uname -m)\" == \"x86_64\" ] && sed -i -e \"s:/usr/lib/collectd:/usr/lib64/collectd:\" $config\n  echo \"Include \\\"$plugin_dir/*.conf\\\"\" >> $config\n}\n\n#### Update configuration for start/stop and reboot ####\n\nif test \"$RS_REBOOT\" = \"true\" -o \"$RS_ALREADY_RUN\" = \"true\"; then\n  service collectd stop\n  write_config\n  service collectd start\n  logger -t RightScale \"Updated collectd configuration on REBOOT.\"\n  rs_tag -a \"rs_monitoring:state=active\" && logger -s -t RightScale \"Setting monitoring active tag\"\n\n#Repo is replaced by the core site.  Re-add the exclude\n  if [[ \"$RS_DISTRO\" =~ centos|redhat.* ]]; then \n    echo -e \"$package_comment\\nexclude=collectd\\n\" >> $yum_epel_config\n  fi\n  exit 0\nfi\n\n#### Install Attached Packages ####\n\nif [ $RS_DISTRO = ubuntu ]; then \n  apt-get -y install librrd4\n  # Only update when using Ubuntu Hardy\n  if [ \"$(lsb_release -rs)\" != \"10.04\" ]; then\n    logger -s -t RightScale \"WARNING These packages were built for Ubuntu Lucid (10.04), you may have issues!\"\n  fi\n\n  if [ \"$RS_ARCH\" = \"x86_64\" ]; then\n    RS_ARCH=\"amd64\"\n  fi   \n\n  logger -s -t RightScale \"Removing any installed version of collectd...\"\n  set -e\n  apt-get -y remove collectd\n  set +e\n  logger -s -t RightScale \"Installing Collectd Packages Now...\"\n  dpkg -i $ATTACH_DIR/*$RS_ARCH.deb\n  echo -e \"$package_comment\\nPackage: collectd collectd-core\\nPin: version 4.10*\\nPin-Priority: 1001\\n\" > $apt_preferences_config\nelse\n  yum erase -y collectd\n  rpm -i $ATTACH_DIR/*$RS_ARCH.rpm\n  echo -e \"$package_comment\\nexclude=collectd\\n\" >> $yum_epel_config\nfi\n\nlogger -s -t RightScale \"Package Installation Complete.\"\n\n\n#### Create the config file ####\n# This should be updated to use default the default config file installed\n# with the package.  The default configs should be modified as needed.\nwrite_config\n\n#### Install a Nightly Crontask to Restart Collectd ####\n\n# Add the task to /etc/crontab, at 04:00 localtime.\n[ -z \"$(grep \"service collectd restart\" /etc/crontab)\" ] && echo '00 4 * * * root service collectd restart > /dev/null' >> /etc/crontab\n\nlogger -s -t RightScale \"Installed nightly restart crontask\"\n\n#### Monitor Processes from Script Input ####\n\n# we always want to monitor collectd itself.\nprocesses=\"  process \\\"collectd\\\"\"\n\nif [ ! -z \"$MON_PROCESSES\" ]; then\n  # Loop over processes and format them properly for the collectd config file.\n  # Store the result in processes environment variable.\n  for p in $MON_PROCESSES; do\n    processes=\"$processes\\n  process \\\"$p\\\"\"\n    logger -s -t RightScale \"Monitoring $p process\" \n  done\nelse\n  logger -s -t RightScale \"No additional processes were specified to monitor.\"\nfi\n\nif [ ! -z \"$MON_PROCESSMATCH\" ]; then\n  # ProcessMatch arguments are passed in as 'name/regex', in a space separated list.\n  # so as we iterate over the list, we have to cut each entry into the two parts.\n  for p in $MON_PROCESSMATCH; do\n    p_name=$(echo $p | cut -d/ -f1)\n    p_regex=$(echo $p | cut -d/ -f2)\n    processes=\"$processes\\n  processmatch \\\"$p_name\\\" \\\"$p_regex\\\"\"\n    logger -s -t RightScale \"Monitoring $p_regex as $p_name\"\n  done\nelse\n  logger -s -t RightScale \"No processmatch inputs have been specified.\"\nfi\n\n# Write the process file into the include directory.\nprocess_conf=\"$plugin_dir/processes.conf\"\n\necho -e \"LoadPlugin Processes\" > $process_conf\necho -e \"<Plugin processes>\"  >> $process_conf\necho -e \"$processes\"  >> $process_conf\necho -e \"</Plugin>\"  >> $process_conf\n\nif [[ \"$RS_DISTRO\" =~ centos|redhat.* ]]; then \n#\n# Patch collectd init script, so it uses collectdmon.  \n#\n# Only needed for CentOS, Ubuntu already does this out of the box.\n#\npatch -N -p 0 -l -c <<'EOF' || logger -s -t RightScale \"Error installing collectdmon\"\n--- /etc/init.d/collectd        Tue Oct 13 17:51:38 2009\n*** ./collectd  Tue Oct 13 17:58:04 2009\n***************\n*** 25,31 ****\n        echo -n $\"Starting $prog: \"\n        if [ -r \"$CONFIG\" ]\n        then\n!               daemon /usr/sbin/collectd -C \"$CONFIG\"\n                RETVAL=$?\n                echo\n                [ $RETVAL -eq 0 ] && touch /var/lock/subsys/$prog\n--- 25,31 ----\n        echo -n $\"Starting $prog: \"\n        if [ -r \"$CONFIG\" ]\n        then\n!               daemon collectdmon -c /usr/sbin/collectd -P /var/run/collectdmon.pid -- -C \"$CONFIG\"\n                RETVAL=$?\n                echo\n                [ $RETVAL -eq 0 ] && touch /var/lock/subsys/$prog\n***************\n*** 33,39 ****\n  }\n  stop () {\n        echo -n $\"Stopping $prog: \"\n!       killproc $prog\n        RETVAL=$?\n        echo\n        [ $RETVAL -eq 0 ] && rm -f /var/lock/subsys/$prog\n--- 33,39 ----\n  }\n  stop () {\n        echo -n $\"Stopping $prog: \"\n!       killproc collectdmon\n        RETVAL=$?\n        echo\n        [ $RETVAL -eq 0 ] && rm -f /var/lock/subsys/$prog\nEOF\n\nfi\nservice collectd restart\n\n#### tag required for RightLink enabled images ####\nrs_tag -a \"rs_monitoring:state=active\" && logger -s -t RightScale \"Setting monitoring active tag\"\n","name":"SYS Monitoring install - 12H1.rc","created_at":"2012/03/27 20:33:47 +0000","updated_at":"2012/03/27 20:33:49 +0000","description":"Installs and configures monitoring data collection for RightScale. Uses collectd 4.10.*.  \nThe MON\\_PROCESSES can be a (space-separated) list of processes to monitor, such as \"httpd mysqld\".\n\n"},"apply":"boot","recipe":null,"position":4}]