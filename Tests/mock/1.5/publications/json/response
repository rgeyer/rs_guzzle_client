HTTP/1.1 200 OK
Server: nginx/1.0.14
Date: Fri, 21 Sep 2012 16:38:12 GMT
Content-Type: application/vnd.rightscale.publication+json;type=collection;charset=utf-8
Connection: keep-alive
Status: 200 OK
X-Runtime: 13658
Content-Length: 216001
X-Request-Uuid: 28f82483b8134a27a9996e2a44d3a232
Set-Cookie: _session_id=47f0e8becff38decfb4c83fbb44b9dc4; path=/; Secure; HttpOnly
Cache-Control: private, max-age=0, must-revalidate

[{"revision_notes":null,"updated_at":"2010/10/18 20:15:08 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:31:21 +0000","user":"rgeyer@mentorcorp.com"},"description":"Creates a new LDAP database with the defined $LDAP_DB_BASE_DN.  If the base dn is empty, a database which will contain all naming contexts (except cn=config) will be created.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Create Database","created_at":"2010/10/18 20:15:03 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:08 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:31:09 +0000","user":"rgeyer@mentorcorp.com"},"description":"Initializes this server as the LDAP provider by adding the syncprov module and overlay to all currently configured databases.\n\nIf this server is already setup as the provider, the syncprov overlay will be deleted and recreated for all configured databases.\n\nIf the server is a consumer, this script will fail.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Initialize Provider","created_at":"2010/10/18 20:15:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:08 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:31:01 +0000","user":"rgeyer@mentorcorp.com"},"description":"Initializes this server as the LDAP consumer by first creating a copy of the provider directory, then adding the syncrepl configuration to each configured database.\n\nIf the server is already setup as a consumer, the syncrepl configuration will be deleted, and recreated with the new settings.\n\nIf the server is a provider, the script will fail. This server will be identified as the provider if it's public IP address matches the DNS response for $LDAPREPLPROVIDER_HOSTNAME.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Initialize Consumer","created_at":"2010/10/18 20:15:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:08 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Oops, forgot to update the attachment.  This is why the \"TODO\" in this script is so important.","time":"2010/10/18 19:29:35 +0000","user":"rgeyer@mentorcorp.com"},"description":"Installs some tools for OpenLDAP administration","name":"LDAP Tools Install","created_at":"2010/10/18 20:15:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:08 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:30:52 +0000","user":"rgeyer@mentorcorp.com"},"description":"Promotes this consumer to the provider for all configured databases by stripping the syncrepl configuration and changing the providers Dynamic DNS record to point to this server.\n\nThis script will fail if this server is already the provider.  This server will be identified as the provider if it's public IP address matches the DNS response for $LDAP_REPL_PROVIDER_HOSTNAME.\n\nThis script will fail if this server is not a consumer, or if it is a consumer for a different provider.\n\nThis script will not make any changes to the current provider, and it is recommended that once this script is run successfully you either terminate the old provider or execute \"LDAP Initialize Consumer\" on it to make it the new consumer.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Promote to Provider","created_at":"2010/10/18 20:15:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:08 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:30:16 +0000","user":"rgeyer@mentorcorp.com"},"description":"Sets the username/commonname and password for the OpenLDAP slapd.d config, also known as cn=config or real-time configuration.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Set Config Admin Details","created_at":"2010/10/18 20:15:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:08 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:34:34 +0000","user":"rgeyer@mentorcorp.com"},"description":"Installs the slapd and ldap utils (assumes Ubuntu).  Enables the bdb and hdb database modules, and any provided schemas.  Configures syslog-ng to record slapd log messages to local1, making them available in the RightScale dashboard.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Install OpenLDAP","created_at":"2010/10/18 20:15:05 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:09 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:30:10 +0000","user":"rgeyer@mentorcorp.com"},"description":"Sets the desired log level for the slapd daemon.\nSee <a href=\"http://www.openldap.org/doc/admin24/slapdconf2.html#olcLogLevel: <level>\">OpenLDAP 2.4 docs</a> for more detail.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Set Log Level","created_at":"2010/10/18 20:15:06 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:09 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:30:02 +0000","user":"rgeyer@mentorcorp.com"},"description":"Loads one or more schemas from /etc/ldap/schema into the running slapd.  This will only add schemas which are not already present.  If the desired schema is dependent upon other schemas, you must supply them all in comma separated $LDAP_SCHEMA_LIST\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Enable Schema(s)","created_at":"2010/10/18 20:15:06 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:09 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:29:54 +0000","user":"rgeyer@mentorcorp.com"},"description":"Enables a single OpenLDAP module.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Enable Module","created_at":"2010/10/18 20:15:06 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:09 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:29:46 +0000","user":"rgeyer@mentorcorp.com"},"description":"Creates an immediate backup of the slapd.d configuration, and all running slapd databases.  The slapd will be stopped for the duration of the backup!\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP DB S3 Backup","created_at":"2010/10/18 20:15:06 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:09 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:02:17 +0000","user":"rgeyer@mentorcorp.com"},"description":"Restores the slapd.d configuration, and all slapd databases from a backup created with the \"LDAP DB S3 Backup\" RightScript. The slapd will be stopped for the duration of the restoration!\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP DB S3 Restore","created_at":"2010/10/18 20:15:06 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:09 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:02:05 +0000","user":"rgeyer@mentorcorp.com"},"description":"Creates a daily cron file (assuming Ubuntu) which cleans up the backup history, keeping only $MAX_BACKUPS_TO_KEEP and creating a new backup for the day.  The new backup is created by running the same script (installed by the \"LDAP Tools Install\" RightScript) as the \"LDAP DB S3 Backup\" RightScript\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP DB S3 Enable Continuous Backup","created_at":"2010/10/18 20:15:07 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/18 20:15:09 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to publish with OpenLDAP Directory Server v1 Server Template.","time":"2010/10/18 19:01:14 +0000","user":"rgeyer@mentorcorp.com"},"description":"Deletes the daily cron file for continuous backups.","name":"LDAP DB S3 Disable Continuous Backup","created_at":"2010/10/18 20:15:07 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":"Initial Commit","updated_at":"2010/10/18 20:15:08 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Initial Commit","time":"2010/10/18 19:59:28 +0000","user":"rgeyer@mentorcorp.com"},"description":"This template will allow you to launch and maintain three different types of OpenLDAP servers.\n\n1) A Stand-Alone OpenLDAP Server.\n2) A Provider in a \"refresh and persist\" replication pair. Read all about it at -> http://www.zytrax.com/books/ldap/ch7/#ol-syncrepl-rap\n3) A Consumer in a \"refresh and persist\" replication pair.\n\nWhichever type of server you launch, it will have the following super-neato features.\n\n1) Can be backed up to an S3 bucket instantly using the \"LDAP DB S3 Backup\" operational RightScript\n2) Can be restored from an S3 bucket instantly using the \"LDAP DB S3 Restore\" operational RightScript\n3) Can be backed up daily to an S3 bucket using the \"LDAP DB Enable Continuous Backup\" operational RightScript\n4) Set the log level for the slapd process using the \"LDAP Set Log Level\" operational RightScript, then monitor the log messages in the \"local1\" log file in the RightScale dashboard\n5) A critical alert will be sent if ephemeral storage (where the LDAP database is stored) has less than 100MB free\n\nThe recommended configuration is to have two instances of this template running at any given time.  One in the Provider role, and one in the Consumer role.  This way you always have a hot spare ready to go in case anything should go wrong with the Provider, you can simply run the \"LDAP Promote to Provider\" operational RightScript on the Consumer, and be back up and running in minutes.\n\nWhen the server is first launched and becomes operational, you'll have a fully operational OpenLDAP instance.  However no database will exist yet, you'll need to create one (or many) with the base naming context(s) you want.  Here's are some quick start guides for the three different server types.\n\n----- Stand-Alone OpenLDAP Server -----\n1) Launch the server\n2) Run the \"LDAP Create Database\" operational RightScript to create your first database\n3) If daily backups are desired, run the \"LDAP DB S3 Enable Continuous Backup\" operational RightScript\n4) Put some stuff in your new LDAP database using your favorite directory tool.  (I really like the Apache Directory Studio!)\n\n----- Provider OpenLDAP Server -----\n1) Follow the steps from the Stand-Alone Server to launch this instance\n2) Run the \"LDAP Initialize Provider\" operational RightScript\n3) Enjoy!\n\n\n----- Consumer OpenLDAP Server -----\n1) Make sure you have another instance running which has already been configured using the steps for the Provider server\n2) Follow the steps from the Stand-Alone Server to launch this instance\n3) Run the \"LDAP Initialize Consumer\" operational RightScript\n4) Enjoy!","name":"OpenLDAP Directory Server v1","created_at":"2010/10/18 20:15:08 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/19 00:32:47 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Some syntax errors in ldapUtils.sh which prevented the promotion of a consumer to a provider.\n\nexec != eval && $1i != $1","time":"2010/10/19 00:26:46 +0000","user":"rgeyer@mentorcorp.com"},"description":"Installs some tools for OpenLDAP administration","name":"LDAP Tools Install","created_at":"2010/10/19 00:32:44 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":4,"actions":[{"rel":"import"}]},{"revision_notes":"Some syntax errors in ldapUtils.sh which prevented the promotion of a consumer to a provider.exec != eval && $1i != $1","updated_at":"2010/10/19 00:32:46 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Had to change the name for the sake of public library submission.","time":"2010/10/19 00:31:34 +0000","user":"rgeyer@mentorcorp.com"},"description":"This template will allow you to launch and maintain three different types of OpenLDAP servers.\n\n1. A Stand-Alone OpenLDAP Server.\n2. A Provider in a \"refresh and persist\" replication pair. Read all about it [here](http://www.zytrax.com/books/ldap/ch7/#ol-syncrepl-rap)\n3. A Consumer in a \"refresh and persist\" replication pair. Read all about it [here](http://www.zytrax.com/books/ldap/ch7/#ol-syncrepl-rap)\n\nThe recommended configuration is to have two instances of this template running at any given time.  One in the Provider role, and one in the Consumer role.  This way you always have a hot spare ready to go in case anything should go wrong with the Provider, you can simply run the *LDAP Promote to Provider* operational RightScript on the Consumer, and be back up and running in minutes.\n\nFeatures\n=====\nWhichever type of server you launch, it will have the following super-neato features.\n\nBackups\n------\n* Can be backed up to an S3 bucket instantly using the *LDAP DB S3 Backup* operational RightScript\n* Can be restored from an S3 bucket instantly using the *LDAP DB S3 Restore* operational RightScript\n* Can be backed up daily to an S3 bucket using the *LDAP DB Enable Continuous Backup* operational RightScript\n\nOther super-neato stuff\n-------------------\n* Set the log level for the slapd process using the *LDAP Set Log Level* operational RightScript, then monitor the log messages in the \"local1\" log file in the RightScale dashboard\n* A critical alert will be sent if ephemeral storage (where the LDAP database is stored) has less than 100MB free\n\nQuick-Start Guides\n============\nWhen the server is first launched and becomes operational, you'll have a fully operational OpenLDAP instance.  However no database will exist yet, you'll need to create one (or many) with the base naming context(s) you want.  Here's are some quick start guides for the three different server types.\n\nStand-Alone OpenLDAP Server\n-----------------------\n1. Launch the server\n2. Run the \"LDAP Create Database\" operational RightScript to create your first database\n3. If daily backups are desired, run the \"LDAP DB S3 Enable Continuous Backup\" operational RightScript\n4. Put some stuff in your new LDAP database using your favorite directory tool.  (I really like the Apache Directory Studio!)\n\nProvider OpenLDAP Server\n--------------------\n1. Follow the steps from the Stand-Alone Server to launch this instance\n2. Run the \"LDAP Initialize Provider\" operational RightScript\n3. Enjoy!\n\nConsumer OpenLDAP Server\n---------------------\n1. Make sure you have another instance running which has already been configured using the steps for the Provider server\n2. Follow the steps from the Stand-Alone Server to launch this instance\n3. Run the \"LDAP Initialize Consumer\" operational RightScript\n4. Enjoy!","name":"OpenLDAP Directory Server v1.1","created_at":"2010/10/19 00:32:45 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/21 19:59:35 +0000","user":"rgeyer@mentorcorp.com"},"description":"Backup a particular DB/schema to s3, using mysqldump.","name":"DB MySQL s3 mysqldump backup (Optional) v1","created_at":"2010/10/21 20:21:24 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/21 19:58:14 +0000","user":"rgeyer@mentorcorp.com"},"description":"","name":"DB MySQL Initialize Empty DB","created_at":"2010/10/21 20:21:25 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/21 19:58:43 +0000","user":"rgeyer@mentorcorp.com"},"description":"Checkout the sources from an s3 tarball.\nSkips the update/retrieval of code if the bucket and package are not set.","name":"WEB app s3 code checkout w/ get latest support v1","created_at":"2010/10/21 20:21:25 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/21 19:56:40 +0000","user":"rgeyer@mentorcorp.com"},"description":"Runs one or more LDIF files pulled from a file stored in an S3 storage bucket at boot time.  This is intended to initialize the empty OpenLDAP database created by the [\"LDAP Create Database\"](http://www.rightscale.com/library/right_scripts/LDAP-Create-Database/12345) RightScript.\r\n\r\n\r\n\r\nRequires the tools installed by the [\"LDAP Tools Install\"](http://www.rightscale.com/library/right_scripts/LDAP-Tools-Install/12345) RightScript.","name":"LDAP Execute LDIF File(s) at boot","created_at":"2010/10/21 20:21:25 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/21 20:04:47 +0000","user":"rgeyer@mentorcorp.com"},"description":"Runs one or more LDIF files pulled from a file stored in an S3 storage bucket.\r\n\r\n\r\n\r\nRequires the tools installed by the [\"LDAP Tools Install\"](http://www.rightscale.com/library/right_scripts/LDAP-Tools-Install/12345) RightScript.","name":"LDAP Execute LDIF File(s)","created_at":"2010/10/21 20:21:25 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/21 19:57:23 +0000","user":"rgeyer@mentorcorp.com"},"description":"First Boot Slave Start\n\n**Description**\n\nThis RightScript performs the following actions:\n* Makes a local Slave copy of the current Master DB.\n* Starts this server as a MySQL Slave to a Master DB.\n* Sets up the correct configuration file for a reboot to continue the slave role.\n\n**First Launch**\n\nBoot-time version of slave initialization. Can be enabled/disabled by setting:\n\n* INIT\\_SLAVE\\_AT\\_BOOT = true/false\n\n_NOTE:_ Setting the value to $ignore is equivalent to true.\n\nWhen enabled, it performs the same actions as its counterpart in the operational script's list: \n* Converts a running DB instance to be a slave of an existing Master DB. \n* Snapshot and pull the necessary files of the running master. \n* Set the slave DNS entry to point to the instance's IP.\n\n**Reboot**\n\nNo action is taken at all. MySQL just restarts and resumes its past role.\n* If the Slave was started, it continues.\n* If the Slave was not started, it stays the same.\n","name":"DB EBS init at boot (Optional) v1","created_at":"2010/10/21 20:21:25 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/21 19:57:49 +0000","user":"rgeyer@mentorcorp.com"},"description":"It downloads a mysqldump file from s3 and imports it into the local server (on database DB_SCHEMA_NAME).\nIf the schema already exists, nothing will be changed in the DB (i.e., no import).\nIf the DB_MYSQLDUMP_PREFIX and DB_MYSQLDUMP_BUCKET are not set (input variable marked as ignored), nothing will be done. ","name":"DB MySQL s3 mysqldump import (Optional) v1","created_at":"2010/10/21 20:21:26 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/21 19:59:09 +0000","user":"rgeyer@mentorcorp.com"},"description":"Install a cron job to perform a nightly backup of a db (DB_SCHEMA_NAME), using mysqldump, and save it to s3.\nIf bucket and prefix input variables are not set (or set to ignore) no cron will be created.","name":"DB MySQL s3 continuous mysqldump backups (Optional) v1","created_at":"2010/10/21 20:21:27 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Initial Commit","updated_at":"2010/10/21 20:21:30 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Initial Commit","time":"2010/10/21 20:18:02 +0000","user":"rgeyer@mentorcorp.com"},"description":"If you're using the RightScale premium server templates [Tomcat6 FrontEnd v9](http://www.rightscale.com/library/server_templates/Tomcat6-FrontEnd-v9/12345) and [Tomcat6 App Server v9](http://www.rightscale.com/library/server_templates/Tomcat6-App-Server-v9/12345) with a database on [MySQL 5.1 EBS v2](http://www.rightscale.com/library/server_templates/MySQL-5-1-EBS-v2/12345) and authentication with LDAP using my [OpenLDAP Directory Server v1.1](http://www.rightscale.com/library/server_templates/OpenLDAP-Directory-Server-v1-1/12345) to run your Java or Grails application in production, you need this template for development, QA, and testing!\n\n***\n\nThis template allows you to setup a single server which hosts all of the services provided by the servers you run in production.  This allows you to setup ancillary environments (QA, Staging, Development) which *almost* exactly mirror your production environment.\n\nMySQL Database Options\n-------------------\nThe template is also very flexible and configurable.  You can choose to load the database directly from the latest EBS snapshot of production, create a new empty database at boot, or restore the database from a previous S3 backup.\n\nBy loading the database from the production EBS snapshot you can quickly and easily create an instant mirror of your production server for testing new code, or a big update, or troubleshooting a problem in production.\n\nBy loading the database from an S3 backup you can run an on demand QA box with a psuedo persistent database backed up to S3 on a regular basis.  When your QA cycle is done, terminate the box secure in the knowledge that your configuration and QA data is still intact ready for the next QA cycle.\n\nBy creating a new empty database you have the freedom to populate it from scripts or other arbitrary backups, making an excellent development and test platform for specific issues and odd data combinations.\n\nLDAP Options\n-----------\nIf your application uses LDAP for authentication, you can launch an instance and load LDIF files stored in an S3 bucket.  If you're not using LDAP, you can opt to disable this service entirely.\n\nBest Practices\n-----------\nSince this template does run so many services, it's highly recommended that you launch it on an **m1.large** instance.  If you don't you're likely consume nearly all of the memory of an **m1.small** and will get critical alerts about low available memory.  Depending on your application, you might be willing/able to ignore these, but it's something you should be aware of.","name":"Tomcat6 Java or Grails (App, FrontEnd, Database & LDAP) - All In One v1","created_at":"2010/10/21 20:21:27 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Ready to be published with the Dev All-in-One ServerTemplate","time":"2010/10/29 03:18:19 +0000","user":"rgeyer@mentorcorp.com"},"description":"Installs git and gitosis.  The gitosis installation is intialized using the private key supplied in $OPT_GITOSIS_KEY.\n\n**After Install**\nFrom a system that has the same private key, you can run the following commands to further configure and use gitosis.\n\n* Use the  *SCM GIT Initialize Repository* RightScript to create a new repository\n* git clone git@<EC2_PUBLIC_IPV4>:gitosis_admin.git\n* Grant access to new repository as needed by making changes to gitosis-admin/gitosis.conf\n* git clone git@<EC2_PUBLIC_IPV4>:<new repository path>","name":"SCM GIT & Gitosis Install","created_at":"2010/10/29 04:54:09 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 03:43:57 +0000","user":"rgeyer@mentorcorp.com"},"description":"Backs up the entire gitosis configuration and git repositories.  It's frankly a bit slow to backup a reasonable sized repo to S3, and switching to EBS is in the works, but this works for data redundancy and easily migrating a repo to a different instance.","name":"SCM GIT & Gitosis Backup to S3","created_at":"2010/10/29 04:54:10 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 03:48:32 +0000","user":"rgeyer@mentorcorp.com"},"description":"Restores the most recent backup with the $GITOSIS_BKUP_PREFIX from the $GITOSIS_BKUP_BUCKET S3 bucket.  Useful for moving a git repo to a different instance, or for disaster recovery","name":"SCM GIT & Gitosis Restore from S3","created_at":"2010/10/29 04:54:10 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 03:51:44 +0000","user":"rgeyer@mentorcorp.com"},"description":"Enables a daily backup (using Ubuntu daily cron) of the gitosis configuration and git repo to S3","name":"SCM GIT & Gitosis Enable Continuous Backup","created_at":"2010/10/29 04:54:10 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 03:45:39 +0000","user":"rgeyer@mentorcorp.com"},"description":"Disables the daily backup of the gitosis configuration and git repo to S3","name":"SCM GIT & Gitosis Disable Continuous Backup","created_at":"2010/10/29 04:54:10 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"All ready to use in the Dev All-in-One template","time":"2010/10/29 02:46:24 +0000","user":"rgeyer@mentorcorp.com"},"description":"Sets up an apache vhost based on the configuration created by the [WEB apache base install v7 RightScript](http://www.rightscale.com/library/right_scripts/WEB-apache-base-install-v7/12345)","name":"WEB Apache simple vhost configure","created_at":"2010/10/29 04:54:11 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 03:54:43 +0000","user":"rgeyer@mentorcorp.com"},"description":"Creates a new repository at $GITOSIS_HOME that's all ready to go.  Don't forget to enable access in gitosis-admin/gitosis.conf","name":"SCM GIT Initialize Bare Repository","created_at":"2010/10/29 04:54:11 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:05:38 +0000","user":"rgeyer@mentorcorp.com"},"description":"Installs the [TeamCity 5.1.5 Continuous Integration](http://www.jetbrains.com/teamcity/) server and makes it available at $WEBSITE_DNS/teamcity/.\n\nUses a MySQL database to store configuration data.  A new database with the name *teamcity* is created, along with a new database user specifically for the app.","name":"CI TeamCity 5.1 Install","created_at":"2010/10/29 04:54:11 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:10:09 +0000","user":"rgeyer@mentorcorp.com"},"description":"Backs up the $TEAMCITY_HOME/data and MySQL database configuration to an S3 bucket.","name":"CI TeamCity 5.1 Backup to S3","created_at":"2010/10/29 04:54:11 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 02:56:29 +0000","user":"rgeyer@mentorcorp.com"},"description":"Enables the JK Module (mod_jk) for the apache vhost identified by $WEBSITE_DNS.  Also sets up the Tomcat6 deployment manager application with the specified user credentials, and maps it to $WEBSITE_DNS/manager/html","name":"WEB Apache enable mod_jk","created_at":"2010/10/29 04:54:12 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:13:27 +0000","user":"rgeyer@mentorcorp.com"},"description":"Restores the most recent backup with the $TEAMCITY_BKUP_PREFIX from the $TEAMCITY_BKUP_BUCKET S3 bucket. Useful for moving teamcity to a different instance, or for disaster recovery","name":"CI TeamCity 5.1 Restore from S3","created_at":"2010/10/29 04:54:12 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 03:09:21 +0000","user":"rgeyer@mentorcorp.com"},"description":"A minor adjustment to the [DB MySQL 5.0 server install v8 script](http://www.rightscale.com/library/right_scripts/DB-MySQL-5-0-server-install-v8/12345). It's been gutted of all CentOS support, and it now creates the db admin user that get's used throughout.\n\n\nInstalls MySQL on server, configured and started.\n\n**Description** \n\nConfigures MySQL with one of the predefined templates based on the instance type.\n\nCurrently 2 main option types exist:\n\n * dedicated (where the mysql config allocates all existing resources of the machine)\n * shared (where the mysql is configured to use less resources so that it can be run concurrently with other apps like apache and rails for example)\n\nThe name of the input variable must match the name of an attachment, without the extension. \n\n**First launch** \n\nInstalled and configures database.  All old configuration is replaced and mysql is installed with a new mysql default database. This version of the script will configure the placements of binlogs in a directory different from the data directory.\n\n**Reboot** \n\nThis script is skipped on a REBOOT of the server.  The MySQL Server is restarted.\n","name":"DB MySQL 5.0 server install v1","created_at":"2010/10/29 04:54:12 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:17:34 +0000","user":"rgeyer@mentorcorp.com"},"description":"Enables a daily backup (using Ubuntu daily cron) of teamcity to S3","name":"CI TeamCity 5.1 Enable Continuous Backup","created_at":"2010/10/29 04:54:13 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:18:48 +0000","user":"rgeyer@mentorcorp.com"},"description":"Disables the daily backup of teamcity to S3","name":"CI TeamCity 5.1 Disable Continuous Backup","created_at":"2010/10/29 04:54:13 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:25:31 +0000","user":"rgeyer@mentorcorp.com"},"description":"Installs the [Artifactory 2.3.0](http://www.jfrog.org/products.php) server and makes it available at $WEBSITE_DNS/artifactory/.\n\nUses a MySQL database to store configuration data.  A new database with the name *artifactory* is created, along with a new database user specifically for the app.","name":"SCM Artifactory 2.3.0 OSS Install","created_at":"2010/10/29 04:54:13 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:28:39 +0000","user":"rgeyer@mentorcorp.com"},"description":"Backs up the $ARTIFACTORY_HOME/data/filestore and MySQL database configuration to an S3 bucket.","name":"SCM Artifactory 2.3.0 OSS Backup to S3","created_at":"2010/10/29 04:54:14 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:31:46 +0000","user":"rgeyer@mentorcorp.com"},"description":"Restores the most recent backup with the $ARTIFACTORY_BKUP_PREFIX from the $ARTIFACTORY_BKUP_BUCKET S3 bucket. Useful for moving artifactory to a different instance, or for disaster recovery","name":"SCM Artifactory 2.3.0 OSS Restore from S3","created_at":"2010/10/29 04:54:14 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:34:58 +0000","user":"rgeyer@mentorcorp.com"},"description":"Enables a daily backup (using Ubuntu daily cron) of artifactory to S3","name":"SCM Artifactory 2.3.0 OSS Enable Continuous Backup","created_at":"2010/10/29 04:54:14 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/29 04:36:04 +0000","user":"rgeyer@mentorcorp.com"},"description":"Disables the daily backup of artifactory to S3","name":"SCM Artifactory 2.3.0 OSS Disable Continuous Backup","created_at":"2010/10/29 04:54:14 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Initial publish to the library","updated_at":"2010/10/29 04:54:17 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Ooops, forgot to set the default inputs to something sensible.","time":"2010/10/29 04:50:41 +0000","user":"rgeyer@mentorcorp.com"},"description":"Starting a new development group, or project?  Need version control, continuous integration, and library management?  Look no further!\n\nDescription\n=======\nThis server template is being used to host all of the services for our development team.  Git and gitosis for version control, TeamCity for continuous integration, and Artifactory for library management.\n\nQuick Start\n=======\nWhen the server first starts up, it will be running Tomcat6, Apache, and MySQL with monitoring, but none of the actual development services.  The installation and configuration scripts for those services are setup as operational scripts to allow you to only fire up the services you need.\n\nYou can just as easily clone the server template and move the install scripts from operation to boot, they're designed to work either way.\n\nDon't forget to enable continuous backups for the services you run, just in case you need to setup a new instance in case of a disaster, or to move your dev system to a bigger instance.","name":"Dev Team All in One v1","created_at":"2010/10/29 04:54:15 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/29 17:39:04 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Fixed the descriptions of the inputs.  The good news is that they worked correctly, they were just mislabeled in this script as compared to the Install script. :-)","time":"2010/10/29 17:29:35 +0000","user":"rgeyer@mentorcorp.com"},"description":"Sets the username/commonname and password for the OpenLDAP slapd.d config, also known as cn=config or real-time configuration.\n\nRequires the tools installed by the \"LDAP Tools Install\" RightScript.","name":"LDAP Set Config Admin Details","created_at":"2010/10/29 17:39:02 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":"Added some defaults, and functionality to load arbitrary LDIF File(s) from S3 at boot or from an operational script!","updated_at":"2010/10/29 17:39:03 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Added some defaults, and functionality to load arbitrary LDIF File(s) from S3 at boot or from an operational script!","time":"2010/10/29 17:36:55 +0000","user":"rgeyer@mentorcorp.com"},"description":"This template will allow you to launch and maintain three different types of OpenLDAP servers.\n\n1. A Stand-Alone OpenLDAP Server.\n2. A Provider in a \"refresh and persist\" replication pair. Read all about it [here](http://www.zytrax.com/books/ldap/ch7/#ol-syncrepl-rap)\n3. A Consumer in a \"refresh and persist\" replication pair. Read all about it [here](http://www.zytrax.com/books/ldap/ch7/#ol-syncrepl-rap)\n\nThe recommended configuration is to have two instances of this template running at any given time.  One in the Provider role, and one in the Consumer role.  This way you always have a hot spare ready to go in case anything should go wrong with the Provider, you can simply run the *LDAP Promote to Provider* operational RightScript on the Consumer, and be back up and running in minutes.\n\nFeatures\n=====\nWhichever type of server you launch, it will have the following super-neato features.\n\nNew in Rev4\n---------\n* You can now run one or many LDIF files (stored in an S3 bucket) against the database at startup, or at any time using an operational script.\n* Added a few more defaults, in particular a list of schemas to get started (core,cosine,inetorgperson, which we use for our application)\n\nBackups\n------\n* Can be backed up to an S3 bucket instantly using the *LDAP DB S3 Backup* operational RightScript\n* Can be restored from an S3 bucket instantly using the *LDAP DB S3 Restore* operational RightScript\n* Can be backed up daily to an S3 bucket using the *LDAP DB Enable Continuous Backup* operational RightScript\n\nOther super-neato stuff\n-------------------\n* Set the log level for the slapd process using the *LDAP Set Log Level* operational RightScript, then monitor the log messages in the \"local1\" log file in the RightScale dashboard\n* A critical alert will be sent if ephemeral storage (where the LDAP database is stored) has less than 100MB free\n\nQuick-Start Guides\n============\nWhen the server is first launched and becomes operational, you'll have a fully operational OpenLDAP instance.  However no database will exist yet, you'll need to create one (or many) with the base naming context(s) you want.  Here's are some quick start guides for the three different server types.\n\nStand-Alone OpenLDAP Server\n-----------------------\n1. Launch the server\n2. Run the \"LDAP Create Database\" operational RightScript to create your first database\n3. If daily backups are desired, run the \"LDAP DB S3 Enable Continuous Backup\" operational RightScript\n4. Put some stuff in your new LDAP database using your favorite directory tool.  (I really like the Apache Directory Studio!)\n\nProvider OpenLDAP Server\n--------------------\n1. Follow the steps from the Stand-Alone Server to launch this instance\n2. Run the \"LDAP Initialize Provider\" operational RightScript\n3. Enjoy!\n\nConsumer OpenLDAP Server\n---------------------\n1. Make sure you have another instance running which has already been configured using the steps for the Provider server\n2. Follow the steps from the Stand-Alone Server to launch this instance\n3. Run the \"LDAP Initialize Consumer\" operational RightScript\n4. Enjoy!","name":"OpenLDAP Directory Server v1.1","created_at":"2010/10/29 17:39:02 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":4,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/30 00:55:56 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/30 00:53:40 +0000","user":"rgeyer@mentorcorp.com"},"description":"","name":"WEB PHP5 & ImageMagick Install","created_at":"2010/10/30 00:55:55 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2010/10/30 00:55:56 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2010/10/30 00:45:53 +0000","user":"rgeyer@mentorcorp.com"},"description":"Installs two php files that are hosted at $WEBSITE_DNS/resizer/.  An index.php file that is used to demonstrate the functionality of the script, and a resizer.php file which accepts a file attachment and a series of inputs from POST.\n\nYou can find the code in github at http://github.com/rgeyer/RESTful-PHP-Resizer.  This script uses the tag rs-script-rev1","name":"APP Install PHP LANCZOS Image Resizer","created_at":"2010/10/30 00:55:55 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Initial Commit","updated_at":"2010/10/30 00:55:56 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Initial Commit","time":"2010/10/30 00:54:44 +0000","user":"rgeyer@mentorcorp.com"},"description":"Sets up a nice environment to run my PHP RESTFul image resizer.  A simple app I threw together to explore a theory.  You can get the code for it at [github](http://github.com/rgeyer/RESTful-PHP-Resizer)\n\nDescription\n=======\nSets up an Ubuntu box with Apache2 and PHP configured and precious little else.  This is intended to be a VERY lightly loaded application server that will convert images in bulk.\n\nCheck out the [github](http://github.com/rgeyer/RESTful-PHP-Resizer) repo for more details on the actual script.","name":"ImageMagick Resizer","created_at":"2010/10/30 00:55:55 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/01/18 17:21:57 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Added support for maint pages in ssl reverse proxy, some tagging, and support for http proxying and forcing https.","time":"2011/01/18 04:53:13 +0000","user":"me@ryangeyer.com"},"description":null,"name":"Linux RightLink 5.6 Compatible","created_at":"2011/01/18 17:21:56 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":"Initial Commit..   Alpha1","updated_at":"2011/01/18 17:21:57 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Initial Commit..   Alpha1","time":"2011/01/18 05:02:05 +0000","user":"me@ryangeyer.com"},"description":"A reverse proxy server configured using Apache2.  This is intended to overcome the issue of having only a single assignable IP address for any EC2 instance.  Setting one of these server instances up allows you to use the IP address assigned to it to forward traffic to a single backend box which may be running many SSL sites on different ports.\n\nEffectively, you're paying $6.11(reserved) or $15.60(on-demand) per month for an additional IP address.  This makes the most sense if you're running a single (big) windows instance to back many of these proxies, which coincidentally is exactly the way that we're using it.\n\nFAQ\n---\n* Why not use nginx?\n  I probably will in the future since it's a bit more conservative about memory and CPU use, but I needed to create this reasonably quickly and get it working in our environment.  I was comfortable with Apache2 and knew it could do the job, so it was the easy choice for rapid deployment.\n* What's up with the \"Alpha\" designation?\n  This ServerTemplate uses Chef, which is still in beta on the RightScale management platform, plus this is the first revision of the ServerTemplate to be published.  That said, this ServerTemplate is in use in production in our environment, and has been tested pretty thoroughly.  Feel free to let me know if you have any problems with this!\n* How come no load balancing?\n  There are other ServerTemplates for that, and our use case doesn't necessitate load balancing.\n\nToDo\n----\n* Add support for a maintenance page/mode\n* Add support for a (god forbid) outage page/mode","name":"Apache2 SSL Reverse Proxy - Alpha1","created_at":"2011/01/18 17:21:56 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Initial Commit","updated_at":"2011/01/25 01:47:24 +0000","publisher":"Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2011/01/25 01:43:52 +0000","user":"me@ryangeyer.com"},"description":"Adds the Ruby bins path to the systems %PATH% variable for the RightScale user only.\n\nThis is most useful for doing stuff in Chef that requires a properly setup Ruby environment.  That is, in fact, how I am using it most frequently in my \"unisex\" (windows and *nix) cookbooks.  https://github.com/rgeyer/cookbooks","name":"SYS Add RightScale Sandbox to Path (Windows)","created_at":"2011/01/25 01:47:24 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Switched to a more Powershell friendly syntax.  Also setting the environment for the \"current\" execution as well as any future ones, since RightLink seems to run this atomically with the rest of the recipes in a boot bundle.","updated_at":"2011/01/25 21:00:47 +0000","publisher":"Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Switched to a more Powershell friendly syntax.  Also setting the environment for the \"current\" execution as well as any future ones, since RightLink seems to run this atomically with the rest of the recipes in a boot bundle.","time":"2011/01/25 21:00:10 +0000","user":"me@ryangeyer.com"},"description":"Adds the Ruby bins path to the systems %PATH% variable for the RightScale user only.\n\nThis is most useful for doing stuff in Chef that requires a properly setup Ruby environment.  That is, in fact, how I am using it most frequently in my \"unisex\" (windows and *nix) cookbooks.  https://github.com/rgeyer/cookbooks","name":"SYS Add RightScale Sandbox to Path (Windows)","created_at":"2011/01/25 21:00:47 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/02/11 20:27:46 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Stable Branches for Linux & RightLink 5.6.","time":"2011/02/02 20:16:33 +0000","user":"me@ryangeyer.com"},"description":null,"name":"Linux RightLink 5.6 Compatible","created_at":"2011/02/02 20:17:12 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":5,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/02/03 21:09:11 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Stable branches for distribution of a beta version of my AIO ServerTemplate.","time":"2011/02/02 20:16:01 +0000","user":"me@ryangeyer.com"},"description":null,"name":"Web & Email vhost AIO","created_at":"2011/02/03 21:09:09 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":"Beta Rev1 - Initial Commit","updated_at":"2011/12/08 18:19:39 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Beta Rev1 - Initial Commit","time":"2011/02/03 20:08:45 +0000","user":"me@ryangeyer.com"},"description":"# Description #\nThis is an All-In-One (AIO) server for hosting web sites/applications and email for one or many domain names (virtual hosting).\n\n## Total Cost of Ownership ##\nThis ServerTemplate is designed to run within the confines of a [t1.micro](http://aws.amazon.com/ec2/instance-types/) EC2 instance.  A t1.micro instance requires that you use an EBS volume to store the operating system.  The MultiCloud Image this ServerTemplate uses automatically creates a 10GB EBS volume for this purpose.\n\nThis server template requires one additional EBS volume for storing configuration and application data, the size of which will vary based on what you're running.\n\nWhen you first sign up for AWS you can take advantage of their [free tier](http://aws.amazon.com/free/) for all services for one year.  Aside from the EBS volume for storing configuration and application data, all other usage of this template falls within the free tier.\n\nWhile using this server template I've averaged $0.12 per month between EIP data transfer costs, and the additional EBS volume.\n\nAfter one year when the free tier expires, you can expect to spend under $15 per month if you pay for a t1.micro reserved instance, broken down thusly.\n\n* t1.micro reservation for 1 year $54 ($4.50/mo but billed once at the beginning)\n* 730hr t1.micro usage @$0.007/hr (Reserved cost in US-EAST cloud) $5.11/mo\n* 10GB EBS Volume $1.00/mo\n* 1GB EBS Volume $0.10/mo\n* 7GB EBS Snapshot Storage (The 1GB configuration/application data volume, full, with 7 days of history, which is the default) $1.05/mo\n\nThat totals out to $11.76/mo, which leaves $3.24 for data transfer, I/O requests and maybe some S3 storage.\n\nAs I personally run this more, I'll be able to give some more real world data, rather than just estimates.  The point though, is that this is dirt cheap given the control you have!\n\n## LAMP Virtual Hosting ##\nThe web hosting environment is a full LAMP stack consisting of;\n\n* Linux - Ubuntu 10.04\n* Apache2 - 2.2.14 (Ubuntu 8.4)\n* MySQL - 5.1.41-3 (Ubuntu 12.9)\n* PHP - 5.3.2-1 (Ubuntu 4.7)\n\n## Email Virtual Hosting ##\nIn addition to the LAMP stack, a Postfix server is installed and configured for virtual hosting of one or many email domains.  Currently, the postfix server is configured to relay email for configured email addresses (more information on that below) to one or more other email addresses.  I use this to accept email for a domain, and effectively \"forward\" it to my gmail account where I manage all of my email.\n\n## Developer Tools & Libraries ##\nThere are also some services and libraries which get installed that will be useful for developers, and which I depend upon for my instance of the server.\n\n* Zend Framework - 1.11.1\n* Gitosis - Latest HEAD revision from git://eagain.net/gitosis.git\n\n# Usage #\n\n## Prerequisites ##\n\n### Elastic IP ###\nIt is *HIGHLY* recommended that you setup an Elastic IP for your server instance.  This will make things like vertical scaling and disaster recovery easier.\n\nAlso, if you're going to be serious about running an email server, using an EIP is the only way to go so you don't get blacklisted etc.  Setup an EIP, then make sure you fill out [this form](https://aws-portal.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request) to setup a reverse DNS record for your hostname (like mail.yourdomain.com) to your EIP.  You can read about why this is important [here](http://www.simpledns.com/kb.aspx?kbid=1052)\n\n### Security Groups ###\nYou'll need to be able to communicate with your server from the interwebs.  This means you'll need to open some ports in one or more security groups, and add your server instance to those security groups.\n\nAs a best practice, try to avoid making all of your changes to the \"default\" security group.  It's also better if you put the ports for each service in it's own security group, though just one security group which opens all ports for this server instance is probably okay too.  Here are the ports that are required to be able to communicate with this server.\n\n* SSH - TCP:22\n* SMTP - TCP:25\n* HTTP - TCP:80\n* HTTPS - TCP:443\n* GIT - TCP:9418\n\n## Launching for the first time ##\nIf you've just imported this ServerTemplate from the library, here's what you need to know to get started.\n\n### Inputs ###\n* Database Admin Password\n\n  Pick a secure password for the database administrator.  The default administrator username is \"administrator\".  It's possible that you'll never need to use these credentials since the Chef recipes set everything up for you, but it's good to have in case of emergency or for administrative tasks not covered in an operational script etc.\n* Gitosis Private Key\n\n  You can leave this blank, in which case a new SSH RSA key will be created for Gitosis to use.  Best practice is to use a key which has been imported into AWS, and is available in the dropdown when \"Key\" is selected in the RightScale dashboard.\n\n![Gitosis Private Key Input Screenshot](http://farm6.static.flickr.com/12345/5411803592_2f13c80854_o.png)\n* Postfix MySQL Database Password\n\n  Pick a secure password for the user account that postfix will use to access the MySQL database.  Did I mention that Postfix configuration information is stored in MySQL?  I promise, I'll explain later.\n* EBS Volume Size in GB\n\n  This server stores all of the data which needs to be persistent on a separate EBS volume to ease backups, disaster recovery, and vertical scaling.  Specify an EBS volume size here that makes sense for the data you're storing, including git repositories, MySQL databases and your web site/application html and code files.\n\nIf you're in a hurry, and just wanted to get this up and running quickly, that's all you'll need to know.\n\n## Disaster Recovery or Vertical Scaling ##\nAs mentioned, all of the configuration and application data for all the services is stored on an EBS volume.  That EBS volume has a snapshot taken of it once per day.  Those snapshots can be used to start a new instance of this server with the data and configuration exactly as it was at that point in time.\n\nThis is useful for vertical scaling.  I.E. Using a bigger, badder EC2 instance type to manage more traffic.  It's also useful for disaster recovery.\n\nTo bring up a new instance from a snapshot, these are the steps.\n\n1. Find the AWS ID of the latest snapshot for your data volume\n  * Alternate first step is to create a snapshot \"right now\" by running the \"rjg_utils::aio_ebs_volume_snapshot\" recipe on the current instance.\n2. Add a new server to your deployment using this ServerTemplate\n3. Click \"Launch\" and set all of your inputs to the desired values\n4. For the \"EBS Volume Snapshot Id\", replace the value \"blank\" with the AWS ID of the snapshot you acquired in step 1\n5. Launch the new instance\n6. Run the \"web_apache::enable_site_vhost\" or \"app_wordpress::deploy\" (which ever is appropriate) once for each vhosted domain this server answers for.\n7. Verify web and email vhosts are working properly (change /etc/hosts file to point to new IP etc)\n8. Change your DNS records from the IP of the old instance, to the new one\n  * **Pro Tip**: Or, if you're using an Elastic IP, just reassign the the EIP to the new instance\n9. Once DNS records are propagated, or EIP remap is finished, decommission old instance\n10. Clean up EBS volume and snapshots of old instance\n  * See \"Managing Artifacts\" below\n\n# Configuring Services #\n\n## Wordpress Powered Website ##\nIf you want to host a Wordpress powered website, you're only a few inputs and clicks away\n\nInputs\n1. MySQL Database Password for this Wordpress instance\n  Pick a secure password which Wordpress will use to access the database.  The Wordpress configuration file will automatically be created with this information\n2. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text \"blank\" in this field.  \"blank\" is a magic word that is used to work around some issues in the current version of RightLink\n3. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\n## Website ##\nIf you want to host a website that's just static HTML, or a mix of HTML and some PHP files, you can set it up by running the \"web_apache::enable_site_vhost\" script.\n\nThis script takes only two inputs.\n1. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text \"blank\" in this field.  \"blank\" is a magic word that is used to work around some issues in the current version of RightLink\n2. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\nRunning the script will create the necessary configuration file(s) for Apache2.  The root directory for the new website will be /mnt/www/<VHOST FQDN>/htdocs.  Put the your web files there and you're all set!\n\n## Postfix Email Relaying ##\nThe configuration for postfix is stored in a MySQL database, thus the input attributes for a postfix MySQL user, database, and password.  Right now, you'll need to get right into the MySQL commandline in order to manipulate the configuration but there are plans to make this much more user friendly in the future.\n\n### Virtual Domains ###\nThe first thing you'll need to do is tell postfix which domain names it'll be handling email for.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each domain you want to handle email for, run the following MySQL query.\n\n_INSERT INTO transport (domain,destination) VALUES ('yourdomain.com','virtual:')_\n\nWhere 'yourdomain.com' is the domain name you want to handle email for.\n\n### Virtual User Aliases ###\nOnce you've defined the domain names that you'll be handling email for, you'll want to setup which email addresses you'll be accepting email for, and what email address to relay them to.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each email address you want to accept email for, run the following MySQL query.\n\n_INSERT INTO virtual (email,destination) VALUES ('you@yourdomain.com','you@gmail.com')_\n\nThe first value is the email address which your server will accept email for.  The 'yourdomain.com' must already be in transport table, which you would have added in the \"Virtual Domains\" section above.\n\nThe second value is the email address you want any emails sent to the 'you@yourdomain.com' relayed to.  It's just that easy!\n\nYou can specify many different email addresses to be relayed to the same destination address.  You can also specify a \"catchall\" destination for a domain by excluding the user.  I.E. Supplying '@yourdomain.com' for the first value, and 'you@gmail.com' as the second value would route any email sent to any address @yourdomain.com to your gmail address.  It's not advisable, but it can be done.\n\n## Gitosis ##\n\n# Managing Artifacts #\nWe've mentioned a couple times above that this server uses an EBS volume to store configuration and application data.  The creation of that EBS volume, and the creation of the snapshots for backups is fully automated.  The number of EBS snapshots for the current instance is even kept in check by the \"aio_ebs_snapshots_to_keep\" attribute.\n\nHowever, when you launch a new instance to replace an existing one, some EBS artifacts get left behind which will need to be manually cleaned up.  Below you'll find information on what things to look out for.  Automating this cleanup is VERY high on my priority list for enhancements of this ServerTemplate.\n\n## EBS Volumes ##\nWhen you terminate a running instance of this server template, the automatically created EBS volume is not deleted.  So after performing the steps from the \"Disaster Recovery or Vertical Scaling\" section above, you'll want to look at the EBS volumes in the same region as the terminated instance, and go ahead and delete it.\n\nYou may want to verify that you have a current snapshot of the volume first, though you would probably have already done that before launching a new instance and terminating the old one.\n\n## EBS Snapshots ##\nSnapshots of the old EBS volume associated with a terminated instance are not automatically deleted by the backup script based on the \"aio_ebs_snapshots_to_keep\" attribute.  This is because the snapshots are not associated with the new volume or instance, so the script has no way of knowing that they are related.\n\nAs a result, you'll want to delete old snapshots which belong to terminated instances and/or deleted EBS volumes.\n\n# TODO #\n* Setup a default vhost\n  * Including an SSL vhost that hosts various tools like phpmyadmin and a management tool for email configuration etc.\n* More alerts\n  * Postfix high load\n  * Postfix not running\n  * MySQL high load\n  * MySQL not running\n  * Low memory\n  * Low disk space on AIO EBS\n  * Apache high load\n  * Apache not running\n* Deployment/management recipes for Zend Framework apps\n* Enable gitweb (probably within aforementioned SSL vhost)\n* Installation/Deployment/management recipes for Drupal? Maybe?\n* Consider swapping apache2 for nginx\n* Full and proper email stack (local delivery, pop3, imap, ldap configuration)","name":"Web (LAMP) & Email (Postfix) vhost AIO - BETA Rev1","created_at":"2011/02/03 21:09:10 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"* Fixed AWS-S3 Errors & Poor Reporting\n* Fixed rewrite log file name\n* Fixed document root & system/maintenance.html paths.","updated_at":"2011/02/11 20:27:46 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"* Fixed AWS-S3 Errors & Poor Reporting\n* Fixed rewrite log file name\n* Fixed document root & system/maintenance.html paths.","time":"2011/02/11 20:26:04 +0000","user":"me@ryangeyer.com"},"description":"A reverse proxy server configured using Apache2.  This is intended to overcome the issue of having only a single assignable IP address for any EC2 instance.  Setting one of these server instances up allows you to use the IP address assigned to it to forward traffic to a single backend box which may be running many SSL sites on different ports.\n\nEffectively, you're paying $6.11(reserved) or $15.60(on-demand) per month for an additional IP address.  This makes the most sense if you're running a single (big) windows instance to back many of these proxies, which coincidentally is exactly the way that we're using it.\n\nFAQ\n---\n* Why not use nginx?\n  I probably will in the future since it's a bit more conservative about memory and CPU use, but I needed to create this reasonably quickly and get it working in our environment.  I was comfortable with Apache2 and knew it could do the job, so it was the easy choice for rapid deployment.\n* What's up with the \"Alpha\" designation?\n  This ServerTemplate uses Chef, which is still in beta on the RightScale management platform, plus this is the first revision of the ServerTemplate to be published.  That said, this ServerTemplate is in use in production in our environment, and has been tested pretty thoroughly.  Feel free to let me know if you have any problems with this!\n* How come no load balancing?\n  There are other ServerTemplates for that, and our use case doesn't necessitate load balancing.\n\nToDo\n----\n* Add support for a maintenance page/mode\n* Add support for a (god forbid) outage page/mode","name":"Apache2 SSL Reverse Proxy - Alpha1","created_at":"2011/02/11 20:27:45 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/04/13 17:20:16 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Committing for release of Nginx Reverse Proxy.  All repos are branched with \"release_20110401\" for this commit.","time":"2011/04/01 22:45:40 +0000","user":"me@ryangeyer.com"},"description":null,"name":"Linux RightLink 5.6 Compatible","created_at":"2011/04/13 17:20:15 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":6,"actions":[{"rel":"import"}]},{"revision_notes":"Initial Commit","updated_at":"2011/04/13 17:20:16 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Initial Commit","time":"2011/04/13 17:19:29 +0000","user":"me@ryangeyer.com"},"description":"This is the natural evolution of my [Apache2 Reverse Proxy ServerTemplate](http://www.rightscale.com/library/server_templates/Apache2-SSL-Reverse-Proxy-Alph/12345)\n\nA reverse proxy server configured using Nginx.  This is intended to overcome the issue of having only a single assignable IP address for any EC2 instance.  Setting one of these server instances up allows you to use the IP address assigned to it to forward traffic to a single backend box which may be running many SSL sites on different ports.\n\nEffectively, you're paying $6.11(reserved) or $15.60(on-demand) per month for an additional IP address.  This makes the most sense if you're running a single (big) windows instance to back many of these proxies, which coincidentally is exactly the way that we're using it.\n\nFAQ\n---\n* What's up with the \"Alpha\" designation?\n  This ServerTemplate uses Chef, which is still in beta on the RightScale management platform, plus this is the first revision of the ServerTemplate to be published.  That said, this ServerTemplate is in use in production in our environment, and has been tested pretty thoroughly.  Feel free to let me know if you have any problems with this!\n* How come no load balancing?\n  There are other ServerTemplates for that, and our use case doesn't necessitate load balancing.\n\nToDo\n----\n* Add support for a maintenance page/mode\n* Add support for a (god forbid) outage page/mode","name":"Nginx SSL Reverse Proxy - Alpha1","created_at":"2011/04/13 17:20:15 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Updated to MCI with RL 5.6.28","updated_at":"2011/04/13 17:31:22 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Updated to MCI with RL 5.6.28","time":"2011/04/13 17:30:53 +0000","user":"me@ryangeyer.com"},"description":"This is the natural evolution of my [Apache2 Reverse Proxy ServerTemplate](http://www.rightscale.com/library/server_templates/Apache2-SSL-Reverse-Proxy-Alph/12345)\n\nA reverse proxy server configured using Nginx.  This is intended to overcome the issue of having only a single assignable IP address for any EC2 instance.  Setting one of these server instances up allows you to use the IP address assigned to it to forward traffic to a single backend box which may be running many SSL sites on different ports.\n\nEffectively, you're paying $6.11(reserved) or $15.60(on-demand) per month for an additional IP address.  This makes the most sense if you're running a single (big) windows instance to back many of these proxies, which coincidentally is exactly the way that we're using it.\n\nFAQ\n---\n* What's up with the \"Alpha\" designation?\n  This ServerTemplate uses Chef, which is still in beta on the RightScale management platform, plus this is the first revision of the ServerTemplate to be published.  That said, this ServerTemplate is in use in production in our environment, and has been tested pretty thoroughly.  Feel free to let me know if you have any problems with this!\n* How come no load balancing?\n  There are other ServerTemplates for that, and our use case doesn't necessitate load balancing.\n\nToDo\n----\n* Add support for a maintenance page/mode\n* Add support for a (god forbid) outage page/mode","name":"Nginx SSL Reverse Proxy - Alpha1","created_at":"2011/04/13 17:31:22 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/05/07 02:24:12 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Updated nginx in github.com/rgeyer/cookbooks_rs.git to support reverse proxying without SSL","time":"2011/05/07 02:07:03 +0000","user":"me@ryangeyer.com"},"description":null,"name":"Linux RightLink 5.6 Compatible","created_at":"2011/05/07 02:24:11 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":7,"actions":[{"rel":"import"}]},{"revision_notes":"Now supports an HTTP only configuration by setting \"Proxy for HTTPS?\" to false","updated_at":"2011/05/07 02:24:12 +0000","publisher":"Mentor Solutions Application Team - Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Now supports an HTTP only configuration by setting \"Proxy for HTTPS?\" to false","time":"2011/05/07 02:13:55 +0000","user":"me@ryangeyer.com"},"description":"This is the natural evolution of my [Apache2 Reverse Proxy ServerTemplate](http://www.rightscale.com/library/server_templates/Apache2-SSL-Reverse-Proxy-Alph/12345)\n\nA reverse proxy server configured using Nginx.  This is intended to overcome the issue of having only a single assignable IP address for any EC2 instance.  Setting one of these server instances up allows you to use the IP address assigned to it to forward traffic to a single backend box which may be running many SSL sites on different ports.\n\nEffectively, you're paying $5.91(reserved) or $15.40(on-demand) per month for an additional IP address.  This makes the most sense if you're running a single (big) windows instance to back many of these proxies, which coincidentally is exactly the way that we're using it.\n\nFAQ\n---\n* What's up with the \"Beta\" designation?\n  This ServerTemplate uses Chef, which is still in beta on the RightScale management platform, plus this is the first revision of the ServerTemplate to be published.  That said, this ServerTemplate is in use in production in our environment, and has been tested pretty thoroughly.  Feel free to let me know if you have any problems with this!\n* How come no load balancing?\n  There are other ServerTemplates for that, and our use case doesn't necessitate load balancing.\n\nToDo\n----\n* Add support for a maintenance page/mode\n* Add support for a (god forbid) outage page/mode\n\nRelease Notes\n------------\n* Rev 3\n  * Now supports an HTTP only configuration by setting \"Proxy for HTTPS?\" to false","name":"Nginx HTTP(S) Reverse Proxy - Beta","created_at":"2011/05/07 02:24:12 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/05/19 19:36:26 +0000","publisher":"Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit, allow null inputs","time":"2011/05/17 05:15:03 +0000","user":"me@ryangeyer.com"},"description":"","name":"[OpsCode] Delete Node","created_at":"2011/05/17 05:47:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/05/19 19:36:26 +0000","publisher":"Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit, allow null inputs","time":"2011/05/17 05:14:53 +0000","user":"me@ryangeyer.com"},"description":"","name":"[OpsCode] Chef Run","created_at":"2011/05/17 05:47:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/05/19 19:36:27 +0000","publisher":"Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit, allow null inputs","time":"2011/05/17 05:14:46 +0000","user":"me@ryangeyer.com"},"description":"","name":"[OpsCode] Initial Chef Run","created_at":"2011/05/17 05:47:05 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/05/19 19:36:27 +0000","publisher":"Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Added lumberjack and sketchy hosts along with UUID to node attributes.  Done tweaking for a while","time":"2011/05/18 16:59:16 +0000","user":"me@ryangeyer.com"},"description":"","name":"[OpsCode] Connect Node","created_at":"2011/05/18 17:00:03 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/05/19 19:36:27 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"AIO Rev2 - Release 20110519","time":"2011/05/19 17:50:03 +0000","user":"me@ryangeyer.com"},"description":null,"name":"Web & Email vhost AIO","created_at":"2011/05/19 19:36:24 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":"Rev2: LAMP -> LNMP, Dropped Gitosis & Zend","updated_at":"2011/12/08 18:19:21 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Rev2: LAMP -> LNMP, Dropped Gitosis & Zend","time":"2011/05/19 18:04:24 +0000","user":"me@ryangeyer.com"},"description":"# Description #\nThis is an All-In-One (AIO) server for hosting PHP based web sites/applications, as well as email for one or many domain names (virtual hosting).\n\n## Total Cost of Ownership ##\nThis ServerTemplate is designed to run within the confines of a [t1.micro](http://aws.amazon.com/ec2/instance-types/) EC2 instance.  A t1.micro instance requires that you use an EBS volume to store the operating system.  The MultiCloud Image this ServerTemplate uses automatically creates an 8GB EBS volume for this purpose.\n\nThis server template requires one additional EBS volume for storing configuration and application data, the size of which will vary based on what you're running.  The default size for this partition is 2GB.  Combined with the 8GB root partition the total EBS footprint is exactly 10GB, the maximum for the AWS free tier.\n\nWhen you first sign up for AWS you can take advantage of their [free tier](http://aws.amazon.com/free/) for all services for one year.\n\nWhile using this server template I've averaged $0.12 per month between EIP data transfer costs, and the additional EBS volume.\n\nAfter one year when the free tier expires, you can expect to spend under $15 per month if you pay for a t1.micro reserved instance, broken down thusly.\n\n* t1.micro reservation for 1 year $54 ($4.50/mo but billed once at the beginning)\n* 730hr t1.micro usage @$0.007/hr (Reserved cost in US-EAST cloud) $5.11/mo\n* 8GB EBS Volume $0.80/mo\n* 2GB EBS Volume $0.20/mo\n* 14GB EBS Snapshot Storage (The 2GB configuration/application data volume, full, with 7 days of history, which is the default) $2.10/mo\n\nThat totals out to $12.71/mo, which leaves $2.29 for data transfer, I/O requests and maybe some S3 storage.\n\nAs I personally run this more, I'll be able to give some more real world data, rather than just estimates.  The point though, is that this is dirt cheap given the control you have!\n\n## LNMP Virtual Hosting ##\nThe web hosting environment is a full LNMP stack consisting of;\n\n* Linux - Ubuntu 10.04\n* Nginx - 1.0.2\n* MySQL - 5.1.41-3 (Ubuntu 12.10)\n* PHP - 5.3.3-1 (Ubuntu 9.3)\n\n## Email Virtual Hosting ##\nIn addition to the LNMP stack, a Postfix server is installed and configured for virtual hosting of one or many email domains.  Currently, the postfix server is configured to relay email for configured email addresses (more information on that below) to one or more other email addresses.  I use this to accept email for a domain, and effectively \"forward\" it to my gmail account where I manage all of my email.\n\n# Usage #\n\n## Prerequisites ##\n\n### Elastic IP ###\nIt is *HIGHLY* recommended that you setup an Elastic IP for your server instance.  This will make things like vertical scaling and disaster recovery easier.\n\nAlso, if you're going to be serious about running an email server, using an EIP is the only way to go so you don't get blacklisted etc.  Setup an EIP, then make sure you fill out [this form](https://aws-portal.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request) to setup a reverse DNS record for your hostname (like mail.yourdomain.com) to your EIP.  You can read about why this is important [here](http://www.simpledns.com/kb.aspx?kbid=1052)\n\n### Security Groups ###\nYou'll need to be able to communicate with your server from the interwebs.  This means you'll need to open some ports in one or more security groups, and add your server instance to those security groups.\n\nAs a best practice, try to avoid making all of your changes to the \"default\" security group.  It's also better if you put the ports for each service in it's own security group, though just one security group which opens all ports for this server instance is probably okay too.  Here are the ports that are required to be able to communicate with this server.\n\n* SSH - TCP:22\n* SMTP - TCP:25\n* HTTP - TCP:80\n* HTTPS - TCP:443\n\n## Launching for the first time ##\nIf you've just imported this ServerTemplate from the library, here's what you need to know to get started.\n\n### Inputs ###\n* Database Admin Password\n\n  Pick a secure password for the database administrator.  The default administrator username is \"administrator\".  It's possible that you'll never need to use these credentials since the Chef recipes set everything up for you, but it's good to have in case of emergency or for administrative tasks not covered in an operational script etc.\n\n* Postfix MySQL Database Password\n\n  Pick a secure password for the user account that postfix will use to access the MySQL database.  Did I mention that Postfix configuration information is stored in MySQL?  I promise, I'll explain later.\n* EBS Volume Size in GB\n\n  This server stores all of the data which needs to be persistent on a separate EBS volume to ease backups, disaster recovery, and vertical scaling.  Specify an EBS volume size here that makes sense for the data you're storing, including git repositories, MySQL databases and your web site/application html and code files.  **NOTE**: The default is 2GB\n\nIf you're in a hurry, and just wanted to get this up and running quickly, that's all you'll need to know.\n\n## Disaster Recovery or Vertical Scaling ##\nAs mentioned, all of the configuration and application data for all the services is stored on an EBS volume.  That EBS volume has a snapshot taken of it once per day.  Those snapshots can be used to start a new instance of this server with the data and configuration exactly as it was at that point in time.\n\nThis is useful for vertical scaling.  I.E. Using a bigger, badder EC2 instance type to manage more traffic.  It's also useful for disaster recovery.\n\nTo bring up a new instance from a snapshot, these are the steps.\n\n1. Find the AWS ID of the latest snapshot for your data volume\n  * Alternate first step is to create a snapshot \"right now\" by running the \"rjg_utils::aio_ebs_volume_snapshot\" recipe on the current instance.\n2. Add a new server to your deployment using this ServerTemplate\n3. Click \"Launch\" and set all of your inputs to the desired values\n4. For the \"EBS Volume Snapshot Id\", replace the value \"blank\" with the AWS ID of the snapshot you acquired in step 1\n5. Launch the new instance\n6. Run the \"web_apache::enable_site_vhost\" or \"app_wordpress::deploy\" (which ever is appropriate) once for each vhosted domain this server answers for.\n7. Verify web and email vhosts are working properly (change /etc/hosts file to point to new IP etc)\n8. Change your DNS records from the IP of the old instance, to the new one\n  * **Pro Tip**: Or, if you're using an Elastic IP, just reassign the the EIP to the new instance\n9. Once DNS records are propagated, or EIP remap is finished, decommission old instance\n10. Clean up EBS volume and snapshots of old instance\n  * See \"Managing Artifacts\" below\n\n# Configuring Services #\n\n## Wordpress Powered Website ##\nIf you want to host a Wordpress powered website, you're only a few inputs and clicks away\n\nInputs\n1. MySQL Database Password for this Wordpress instance\n  Pick a secure password which Wordpress will use to access the database.  The Wordpress configuration file will automatically be created with this information\n2. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text \"blank\" in this field.  \"blank\" is a magic word that is used to work around some issues in the current version of RightLink\n3. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\n## Website ##\nIf you want to host a website that's just static HTML, or a mix of HTML and some PHP files, you can set it up by running the \"web_apache::enable_site_vhost\" script.\n\nThis script takes only two inputs.\n1. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text \"blank\" in this field.  \"blank\" is a magic word that is used to work around some issues in the current version of RightLink\n2. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\nRunning the script will create the necessary configuration file(s) for Apache2.  The root directory for the new website will be /mnt/www/<VHOST FQDN>/htdocs.  Put the your web files there and you're all set!\n\n## Postfix Email Relaying ##\nThe configuration for postfix is stored in a MySQL database, thus the input attributes for a postfix MySQL user, database, and password.  Right now, you'll need to get right into the MySQL commandline in order to manipulate the configuration but there are plans to make this much more user friendly in the future.\n\n### Virtual Domains ###\nThe first thing you'll need to do is tell postfix which domain names it'll be handling email for.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each domain you want to handle email for, run the following MySQL query.\n\n_INSERT INTO transport (domain,destination) VALUES ('yourdomain.com','virtual:')_\n\nWhere 'yourdomain.com' is the domain name you want to handle email for.\n\n### Virtual User Aliases ###\nOnce you've defined the domain names that you'll be handling email for, you'll want to setup which email addresses you'll be accepting email for, and what email address to relay them to.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each email address you want to accept email for, run the following MySQL query.\n\n_INSERT INTO virtual (email,destination) VALUES ('you@yourdomain.com','you@gmail.com')_\n\nThe first value is the email address which your server will accept email for.  The 'yourdomain.com' must already be in transport table, which you would have added in the \"Virtual Domains\" section above.\n\nThe second value is the email address you want any emails sent to the 'you@yourdomain.com' relayed to.  It's just that easy!\n\nYou can specify many different email addresses to be relayed to the same destination address.  You can also specify a \"catchall\" destination for a domain by excluding the user.  I.E. Supplying '@yourdomain.com' for the first value, and 'you@gmail.com' as the second value would route any email sent to any address @yourdomain.com to your gmail address.  It's not advisable, but it can be done.\n\n# Managing Artifacts #\nWe've mentioned a couple times above that this server uses an EBS volume to store configuration and application data.  The creation of that EBS volume, and the creation of the snapshots for backups is fully automated.  The number of EBS snapshots for the current instance is even kept in check by the \"aio_ebs_snapshots_to_keep\" attribute.\n\nHowever, when you launch a new instance to replace an existing one, some EBS artifacts get left behind which will need to be manually cleaned up.  Below you'll find information on what things to look out for.  Automating this cleanup is VERY high on my priority list for enhancements of this ServerTemplate.\n\n## EBS Volumes ##\nWhen you terminate a running instance of this server template, the automatically created EBS volume is not deleted.  So after performing the steps from the \"Disaster Recovery or Vertical Scaling\" section above, you'll want to look at the EBS volumes in the same region as the terminated instance, and go ahead and delete it.\n\nYou may want to verify that you have a current snapshot of the volume first, though you would probably have already done that before launching a new instance and terminating the old one.\n\n## EBS Snapshots ##\nSnapshots of the old EBS volume associated with a terminated instance are not automatically deleted by the backup script based on the \"aio_ebs_snapshots_to_keep\" attribute.  This is because the snapshots are not associated with the new volume or instance, so the script has no way of knowing that they are related.\n\nAs a result, you'll want to delete old snapshots which belong to terminated instances and/or deleted EBS volumes.\n\n# Change Log #\n* Rev 1\n  * Initial release\n* Rev 2\n  * Replaced Apache with Nginx\n  * Running PHP5 FPM application server rather than a PHP module for Apache or Nginx\n  * Dropped incomplete support for Zend Framework\n  * Dropped Gitosis as a default, since I imagine I'm the only person using it, and it's a bit out of place\n  * Added Alerts for critical systems and failure/limp conditions\n  * New MCI which includes RightLink 5.6.28 and creates an 8GB root partition rather than 10GB\n  * Added ability to connect this server with the [Opscode](http://www.opscode.com/platform/) Chef platform to further customize your instance\n\n\n# TODO #\n* Setup a default vhost\n  * Including an SSL vhost that hosts various tools like phpmyadmin and a management tool for email configuration etc.\n* More alerts\n  * Postfix high load\n  * MySQL high load\n  * Low memory\n  * Nginx high load\n* Reconsider ZendFramework support\n* Enable gitweb (probably within aforementioned SSL vhost)\n* Installation/Deployment/management recipes for Drupal? Maybe?\n* Full and proper email stack (local delivery, pop3, imap, ldap configuration)","name":"LNMP & Email Vhosting All-In-One with Nginx, PHP5-FPM, MySQL 5.1, and Postfix - Rev2","created_at":"2011/05/19 19:36:25 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/06/01 00:20:27 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"AIO Rev3 - Release 20110531\n\nFixes for app_wordpress","time":"2011/06/01 00:06:48 +0000","user":"me@ryangeyer.com"},"description":null,"name":"Web & Email vhost AIO","created_at":"2011/06/01 00:20:25 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":4,"actions":[{"rel":"import"}]},{"revision_notes":"Rev3 - Fixed app_wordpress::update, special characters now allowed in MySQL passwords","updated_at":"2011/12/08 18:19:32 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Rev3 - Fixed app_wordpress::update, special characters now allowed in MySQL passwords","time":"2011/06/01 00:18:54 +0000","user":"me@ryangeyer.com"},"description":"# Description #\nThis is an All-In-One (AIO) server for hosting PHP based web sites/applications, as well as email for one or many domain names (virtual hosting).\n\n## Total Cost of Ownership ##\nThis ServerTemplate is designed to run within the confines of a [t1.micro](http://aws.amazon.com/ec2/instance-types/) EC2 instance.  A t1.micro instance requires that you use an EBS volume to store the operating system.  The MultiCloud Image this ServerTemplate uses automatically creates an 8GB EBS volume for this purpose.\n\nThis server template requires one additional EBS volume for storing configuration and application data, the size of which will vary based on what you're running.  The default size for this partition is 2GB.  Combined with the 8GB root partition the total EBS footprint is exactly 10GB, the maximum for the AWS free tier.\n\nWhen you first sign up for AWS you can take advantage of their [free tier](http://aws.amazon.com/free/) for all services for one year.\n\nWhile using this server template I've averaged $0.12 per month between EIP data transfer costs, and the additional EBS volume.\n\nAfter one year when the free tier expires, you can expect to spend under $15 per month if you pay for a t1.micro reserved instance, broken down thusly.\n\n* t1.micro reservation for 1 year $54 ($4.50/mo but billed once at the beginning)\n* 730hr t1.micro usage @$0.007/hr (Reserved cost in US-EAST cloud) $5.11/mo\n* 8GB EBS Volume $0.80/mo\n* 2GB EBS Volume $0.20/mo\n* 14GB EBS Snapshot Storage (The 2GB configuration/application data volume, full, with 7 days of history, which is the default) $2.10/mo\n\nThat totals out to $12.71/mo, which leaves $2.29 for data transfer, I/O requests and maybe some S3 storage.\n\nAs I personally run this more, I'll be able to give some more real world data, rather than just estimates.  The point though, is that this is dirt cheap given the control you have!\n\n## LNMP Virtual Hosting ##\nThe web hosting environment is a full LNMP stack consisting of;\n\n* Linux - Ubuntu 10.04\n* Nginx - 1.0.2\n* MySQL - 5.1.41-3 (Ubuntu 12.10)\n* PHP - 5.3.3-1 (Ubuntu 9.3)\n\n## Email Virtual Hosting ##\nIn addition to the LNMP stack, a Postfix server is installed and configured for virtual hosting of one or many email domains.  Currently, the postfix server is configured to relay email for configured email addresses (more information on that below) to one or more other email addresses.  I use this to accept email for a domain, and effectively \"forward\" it to my gmail account where I manage all of my email.\n\n# Usage #\n\n## Prerequisites ##\n\n### Elastic IP ###\nIt is *HIGHLY* recommended that you setup an Elastic IP for your server instance.  This will make things like vertical scaling and disaster recovery easier.\n\nAlso, if you're going to be serious about running an email server, using an EIP is the only way to go so you don't get blacklisted etc.  Setup an EIP, then make sure you fill out [this form](https://aws-portal.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request) to setup a reverse DNS record for your hostname (like mail.yourdomain.com) to your EIP.  You can read about why this is important [here](http://www.simpledns.com/kb.aspx?kbid=1052)\n\n### Security Groups ###\nYou'll need to be able to communicate with your server from the interwebs.  This means you'll need to open some ports in one or more security groups, and add your server instance to those security groups.\n\nAs a best practice, try to avoid making all of your changes to the \"default\" security group.  It's also better if you put the ports for each service in it's own security group, though just one security group which opens all ports for this server instance is probably okay too.  Here are the ports that are required to be able to communicate with this server.\n\n* SSH - TCP:22\n* SMTP - TCP:25\n* HTTP - TCP:80\n* HTTPS - TCP:443\n\n## Launching for the first time ##\nIf you've just imported this ServerTemplate from the library, here's what you need to know to get started.\n\n### Inputs ###\n* Database Admin Password\n\n  Pick a secure password for the database administrator.  The default administrator username is \"administrator\".  It's possible that you'll never need to use these credentials since the Chef recipes set everything up for you, but it's good to have in case of emergency or for administrative tasks not covered in an operational script etc.\n\n* Postfix MySQL Database Password\n\n  Pick a secure password for the user account that postfix will use to access the MySQL database.  Did I mention that Postfix configuration information is stored in MySQL?  I promise, I'll explain later.\n* EBS Volume Size in GB\n\n  This server stores all of the data which needs to be persistent on a separate EBS volume to ease backups, disaster recovery, and vertical scaling.  Specify an EBS volume size here that makes sense for the data you're storing, including git repositories, MySQL databases and your web site/application html and code files.  **NOTE**: The default is 2GB\n\nIf you're in a hurry, and just wanted to get this up and running quickly, that's all you'll need to know.\n\n## Disaster Recovery or Vertical Scaling ##\nAs mentioned, all of the configuration and application data for all the services is stored on an EBS volume.  That EBS volume has a snapshot taken of it once per day.  Those snapshots can be used to start a new instance of this server with the data and configuration exactly as it was at that point in time.\n\nThis is useful for vertical scaling.  I.E. Using a bigger, badder EC2 instance type to manage more traffic.  It's also useful for disaster recovery.\n\nTo bring up a new instance from a snapshot, these are the steps.\n\n1. Find the AWS ID of the latest snapshot for your data volume\n  * Alternate first step is to create a snapshot \"right now\" by running the \"rjg_utils::aio_ebs_volume_snapshot\" recipe on the current instance.\n2. Add a new server to your deployment using this ServerTemplate\n3. Click \"Launch\" and set all of your inputs to the desired values\n4. For the \"EBS Volume Snapshot Id\", replace the value \"blank\" with the AWS ID of the snapshot you acquired in step 1\n5. Launch the new instance\n6. Run the \"web_apache::enable_site_vhost\" or \"app_wordpress::deploy\" (which ever is appropriate) once for each vhosted domain this server answers for.\n7. Verify web and email vhosts are working properly (change /etc/hosts file to point to new IP etc)\n8. Change your DNS records from the IP of the old instance, to the new one\n  * **Pro Tip**: Or, if you're using an Elastic IP, just reassign the the EIP to the new instance\n9. Once DNS records are propagated, or EIP remap is finished, decommission old instance\n10. Clean up EBS volume and snapshots of old instance\n  * See \"Managing Artifacts\" below\n\n# Configuring Services #\n\n## Wordpress Powered Website ##\nIf you want to host a Wordpress powered website, you're only a few inputs and clicks away\n\nInputs\n1. MySQL Database Password for this Wordpress instance\n  Pick a secure password which Wordpress will use to access the database.  The Wordpress configuration file will automatically be created with this information\n2. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text \"blank\" in this field.  \"blank\" is a magic word that is used to work around some issues in the current version of RightLink\n3. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\n## Website ##\nIf you want to host a website that's just static HTML, or a mix of HTML and some PHP files, you can set it up by running the \"web_apache::enable_site_vhost\" script.\n\nThis script takes only two inputs.\n1. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text \"blank\" in this field.  \"blank\" is a magic word that is used to work around some issues in the current version of RightLink\n2. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\nRunning the script will create the necessary configuration file(s) for Apache2.  The root directory for the new website will be /mnt/www/<VHOST FQDN>/htdocs.  Put the your web files there and you're all set!\n\n## Postfix Email Relaying ##\nThe configuration for postfix is stored in a MySQL database, thus the input attributes for a postfix MySQL user, database, and password.  Right now, you'll need to get right into the MySQL commandline in order to manipulate the configuration but there are plans to make this much more user friendly in the future.\n\n### Virtual Domains ###\nThe first thing you'll need to do is tell postfix which domain names it'll be handling email for.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each domain you want to handle email for, run the following MySQL query.\n\n_INSERT INTO transport (domain,destination) VALUES ('yourdomain.com','virtual:')_\n\nWhere 'yourdomain.com' is the domain name you want to handle email for.\n\n### Virtual User Aliases ###\nOnce you've defined the domain names that you'll be handling email for, you'll want to setup which email addresses you'll be accepting email for, and what email address to relay them to.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each email address you want to accept email for, run the following MySQL query.\n\n_INSERT INTO virtual (email,destination) VALUES ('you@yourdomain.com','you@gmail.com')_\n\nThe first value is the email address which your server will accept email for.  The 'yourdomain.com' must already be in transport table, which you would have added in the \"Virtual Domains\" section above.\n\nThe second value is the email address you want any emails sent to the 'you@yourdomain.com' relayed to.  It's just that easy!\n\nYou can specify many different email addresses to be relayed to the same destination address.  You can also specify a \"catchall\" destination for a domain by excluding the user.  I.E. Supplying '@yourdomain.com' for the first value, and 'you@gmail.com' as the second value would route any email sent to any address @yourdomain.com to your gmail address.  It's not advisable, but it can be done.\n\n# Managing Artifacts #\nWe've mentioned a couple times above that this server uses an EBS volume to store configuration and application data.  The creation of that EBS volume, and the creation of the snapshots for backups is fully automated.  The number of EBS snapshots for the current instance is even kept in check by the \"aio_ebs_snapshots_to_keep\" attribute.\n\nHowever, when you launch a new instance to replace an existing one, some EBS artifacts get left behind which will need to be manually cleaned up.  Below you'll find information on what things to look out for.  Automating this cleanup is VERY high on my priority list for enhancements of this ServerTemplate.\n\n## EBS Volumes ##\nWhen you terminate a running instance of this server template, the automatically created EBS volume is not deleted.  So after performing the steps from the \"Disaster Recovery or Vertical Scaling\" section above, you'll want to look at the EBS volumes in the same region as the terminated instance, and go ahead and delete it.\n\nYou may want to verify that you have a current snapshot of the volume first, though you would probably have already done that before launching a new instance and terminating the old one.\n\n## EBS Snapshots ##\nSnapshots of the old EBS volume associated with a terminated instance are not automatically deleted by the backup script based on the \"aio_ebs_snapshots_to_keep\" attribute.  This is because the snapshots are not associated with the new volume or instance, so the script has no way of knowing that they are related.\n\nAs a result, you'll want to delete old snapshots which belong to terminated instances and/or deleted EBS volumes.\n\n# Change Log #\n* Rev 1\n  * Initial release\n* Rev 2\n  * Replaced Apache with Nginx\n  * Running PHP5 FPM application server rather than a PHP module for Apache or Nginx\n  * Dropped incomplete support for Zend Framework\n  * Dropped Gitosis as a default, since I imagine I'm the only person using it, and it's a bit out of place\n  * Added Alerts for critical systems and failure/limp conditions\n  * New MCI which includes RightLink 5.6.28 and creates an 8GB root partition rather than 10GB\n  * Added ability to connect this server with the [Opscode](http://www.opscode.com/platform/) Chef platform to further customize your instance\n\n\n# TODO #\n* Setup a default vhost\n  * Including an SSL vhost that hosts various tools like phpmyadmin and a management tool for email configuration etc.\n* More alerts\n  * Postfix high load\n  * MySQL high load\n  * Low memory\n  * Nginx high load\n* Reconsider ZendFramework support\n* Enable gitweb (probably within aforementioned SSL vhost)\n* Installation/Deployment/management recipes for Drupal? Maybe?\n* Full and proper email stack (local delivery, pop3, imap, ldap configuration)","name":"LNMP & Email Vhosting All-In-One with Nginx, PHP5-FPM, MySQL 5.1, and Postfix - Rev3","created_at":"2011/06/01 00:20:26 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":"Initial Commit","updated_at":"2011/07/22 20:44:13 +0000","publisher":"Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Initial Commit","time":"2011/07/22 19:12:41 +0000","user":"me@ryangeyer.com"},"description":"Removes the RightScale Rubygem mirrors from the list of sources for the gem executable both in the RightScale sandbox, and for the system ruby.","name":"SYS - Remove RightScale Rubygem mirrors","created_at":"2011/07/22 19:13:22 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Shebangs are nice","updated_at":"2011/07/22 20:43:56 +0000","publisher":"Ryan Geyer","content_type":"RightScript","commit_message":{"text":"Shebangs are nice","time":"2011/07/22 20:43:27 +0000","user":"me@ryangeyer.com"},"description":"Removes the RightScale Rubygem mirrors from the list of sources for the gem executable both in the RightScale sandbox, and for the system ruby.","name":"SYS - Remove RightScale Rubygem mirrors","created_at":"2011/07/22 20:43:56 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2011/12/08 18:18:04 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Nginx update to fix a bug in the latest ubuntu package.","time":"2011/12/08 18:11:50 +0000","user":"ryan.geyer@rightscale.com"},"description":null,"name":"Web & Email vhost AIO","created_at":"2011/12/08 18:18:02 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":5,"actions":[{"rel":"import"}]},{"revision_notes":"Rev 4","updated_at":"2011/12/08 18:19:12 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Rev 4","time":"2011/12/08 18:12:49 +0000","user":"ryan.geyer@rightscale.com"},"description":"# Description #\nThis is an All-In-One (AIO) server for hosting PHP based web sites/applications, as well as email for one or many domain names (virtual hosting).\n\n## Total Cost of Ownership ##\nThis ServerTemplate is designed to run within the confines of a [t1.micro](http://aws.amazon.com/ec2/instance-types/) EC2 instance.  A t1.micro instance requires that you use an EBS volume to store the operating system.  The MultiCloud Image this ServerTemplate uses automatically creates an 8GB EBS volume for this purpose.\n\nThis server template requires one additional EBS volume for storing configuration and application data, the size of which will vary based on what you're running.  The default size for this partition is 2GB.  Combined with the 8GB root partition the total EBS footprint is exactly 10GB, the maximum for the AWS free tier.\n\nWhen you first sign up for AWS you can take advantage of their [free tier](http://aws.amazon.com/free/) for all services for one year.\n\nWhile using this server template I've averaged $0.12 per month between EIP data transfer costs, and the additional EBS volume.\n\nAfter one year when the free tier expires, you can expect to spend under $15 per month if you pay for a t1.micro reserved instance, broken down thusly.\n\n* t1.micro reservation for 1 year $54 ($4.50/mo but billed once at the beginning)\n* 730hr t1.micro usage @$0.007/hr (Reserved cost in US-EAST cloud) $5.11/mo\n* 8GB EBS Volume $0.80/mo\n* 2GB EBS Volume $0.20/mo\n* 14GB EBS Snapshot Storage (The 2GB configuration/application data volume, full, with 7 days of history, which is the default) $2.10/mo\n\nThat totals out to $12.71/mo, which leaves $2.29 for data transfer, I/O requests and maybe some S3 storage.\n\nAs I personally run this more, I'll be able to give some more real world data, rather than just estimates.  The point though, is that this is dirt cheap given the control you have!\n\n## LNMP Virtual Hosting ##\nThe web hosting environment is a full LNMP stack consisting of;\n\n* Linux - Ubuntu 10.04\n* Nginx - 1.0.2\n* MySQL - 5.1.41-3 (Ubuntu 12.10)\n* PHP - 5.3.3-1 (Ubuntu 9.3)\n\n## Email Virtual Hosting ##\nIn addition to the LNMP stack, a Postfix server is installed and configured for virtual hosting of one or many email domains.  Currently, the postfix server is configured to relay email for configured email addresses (more information on that below) to one or more other email addresses.  I use this to accept email for a domain, and effectively \"forward\" it to my gmail account where I manage all of my email.\n\n# Usage #\n\n## Prerequisites ##\n\n### Elastic IP ###\nIt is *HIGHLY* recommended that you setup an Elastic IP for your server instance.  This will make things like vertical scaling and disaster recovery easier.\n\nAlso, if you're going to be serious about running an email server, using an EIP is the only way to go so you don't get blacklisted etc.  Setup an EIP, then make sure you fill out [this form](https://aws-portal.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request) to setup a reverse DNS record for your hostname (like mail.yourdomain.com) to your EIP.  You can read about why this is important [here](http://www.simpledns.com/kb.aspx?kbid=1052)\n\n### Security Groups ###\nYou'll need to be able to communicate with your server from the interwebs.  This means you'll need to open some ports in one or more security groups, and add your server instance to those security groups.\n\nAs a best practice, try to avoid making all of your changes to the \"default\" security group.  It's also better if you put the ports for each service in it's own security group, though just one security group which opens all ports for this server instance is probably okay too.  Here are the ports that are required to be able to communicate with this server.\n\n* SSH - TCP:22\n* SMTP - TCP:25\n* HTTP - TCP:80\n* HTTPS - TCP:443\n\n## Launching for the first time ##\nIf you've just imported this ServerTemplate from the library, here's what you need to know to get started.\n\n### Inputs ###\n* Database Admin Password\n\n  Pick a secure password for the database administrator.  The default administrator username is \"administrator\".  It's possible that you'll never need to use these credentials since the Chef recipes set everything up for you, but it's good to have in case of emergency or for administrative tasks not covered in an operational script etc.\n\n* Postfix MySQL Database Password\n\n  Pick a secure password for the user account that postfix will use to access the MySQL database.  Did I mention that Postfix configuration information is stored in MySQL?  I promise, I'll explain later.\n* EBS Volume Size in GB\n\n  This server stores all of the data which needs to be persistent on a separate EBS volume to ease backups, disaster recovery, and vertical scaling.  Specify an EBS volume size here that makes sense for the data you're storing, including git repositories, MySQL databases and your web site/application html and code files.  **NOTE**: The default is 2GB\n\nIf you're in a hurry, and just wanted to get this up and running quickly, that's all you'll need to know.\n\n## Disaster Recovery or Vertical Scaling ##\nAs mentioned, all of the configuration and application data for all the services is stored on an EBS volume.  That EBS volume has a snapshot taken of it once per day.  Those snapshots can be used to start a new instance of this server with the data and configuration exactly as it was at that point in time.\n\nThis is useful for vertical scaling.  I.E. Using a bigger, badder EC2 instance type to manage more traffic.  It's also useful for disaster recovery.\n\nTo bring up a new instance from a snapshot, these are the steps.\n\n1. Find the AWS ID of the latest snapshot for your data volume\n  * Alternate first step is to create a snapshot \"right now\" by running the \"rjg_utils::aio_ebs_volume_snapshot\" recipe on the current instance.\n2. Add a new server to your deployment using this ServerTemplate\n3. Click \"Launch\" and set all of your inputs to the desired values\n4. For the \"EBS Volume Snapshot Id\", replace the value \"blank\" with the AWS ID of the snapshot you acquired in step 1\n5. Launch the new instance\n6. Run the \"web_apache::enable_site_vhost\" or \"app_wordpress::deploy\" (which ever is appropriate) once for each vhosted domain this server answers for.\n7. Verify web and email vhosts are working properly (change /etc/hosts file to point to new IP etc)\n8. Change your DNS records from the IP of the old instance, to the new one\n  * **Pro Tip**: Or, if you're using an Elastic IP, just reassign the the EIP to the new instance\n9. Once DNS records are propagated, or EIP remap is finished, decommission old instance\n10. Clean up EBS volume and snapshots of old instance\n  * See \"Managing Artifacts\" below\n\n# Configuring Services #\n\n## Wordpress Powered Website ##\nIf you want to host a Wordpress powered website, you're only a few inputs and clicks away\n\nInputs\n1. MySQL Database Password for this Wordpress instance\n  Pick a secure password which Wordpress will use to access the database.  The Wordpress configuration file will automatically be created with this information\n2. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text \"blank\" in this field.  \"blank\" is a magic word that is used to work around some issues in the current version of RightLink\n3. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\n## Website ##\nIf you want to host a website that's just static HTML, or a mix of HTML and some PHP files, you can set it up by running the \"web_apache::enable_site_vhost\" script.\n\nThis script takes only two inputs.\n1. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text \"blank\" in this field.  \"blank\" is a magic word that is used to work around some issues in the current version of RightLink\n2. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\nRunning the script will create the necessary configuration file(s) for Apache2.  The root directory for the new website will be /mnt/www/<VHOST FQDN>/htdocs.  Put the your web files there and you're all set!\n\n## Postfix Email Relaying ##\nThe configuration for postfix is stored in a MySQL database, thus the input attributes for a postfix MySQL user, database, and password.  Right now, you'll need to get right into the MySQL commandline in order to manipulate the configuration but there are plans to make this much more user friendly in the future.\n\n### Virtual Domains ###\nThe first thing you'll need to do is tell postfix which domain names it'll be handling email for.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each domain you want to handle email for, run the following MySQL query.\n\n_INSERT INTO transport (domain,destination) VALUES ('yourdomain.com','virtual:')_\n\nWhere 'yourdomain.com' is the domain name you want to handle email for.\n\n### Virtual User Aliases ###\nOnce you've defined the domain names that you'll be handling email for, you'll want to setup which email addresses you'll be accepting email for, and what email address to relay them to.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each email address you want to accept email for, run the following MySQL query.\n\n_INSERT INTO virtual (email,destination) VALUES ('you@yourdomain.com','you@gmail.com')_\n\nThe first value is the email address which your server will accept email for.  The 'yourdomain.com' must already be in transport table, which you would have added in the \"Virtual Domains\" section above.\n\nThe second value is the email address you want any emails sent to the 'you@yourdomain.com' relayed to.  It's just that easy!\n\nYou can specify many different email addresses to be relayed to the same destination address.  You can also specify a \"catchall\" destination for a domain by excluding the user.  I.E. Supplying '@yourdomain.com' for the first value, and 'you@gmail.com' as the second value would route any email sent to any address @yourdomain.com to your gmail address.  It's not advisable, but it can be done.\n\n# Managing Artifacts #\nWe've mentioned a couple times above that this server uses an EBS volume to store configuration and application data.  The creation of that EBS volume, and the creation of the snapshots for backups is fully automated.  The number of EBS snapshots for the current instance is even kept in check by the \"aio_ebs_snapshots_to_keep\" attribute.\n\nHowever, when you launch a new instance to replace an existing one, some EBS artifacts get left behind which will need to be manually cleaned up.  Below you'll find information on what things to look out for.  Automating this cleanup is VERY high on my priority list for enhancements of this ServerTemplate.\n\n## EBS Volumes ##\nWhen you terminate a running instance of this server template, the automatically created EBS volume is not deleted.  So after performing the steps from the \"Disaster Recovery or Vertical Scaling\" section above, you'll want to look at the EBS volumes in the same region as the terminated instance, and go ahead and delete it.\n\nYou may want to verify that you have a current snapshot of the volume first, though you would probably have already done that before launching a new instance and terminating the old one.\n\n## EBS Snapshots ##\nSnapshots of the old EBS volume associated with a terminated instance are not automatically deleted by the backup script based on the \"aio_ebs_snapshots_to_keep\" attribute.  This is because the snapshots are not associated with the new volume or instance, so the script has no way of knowing that they are related.\n\nAs a result, you'll want to delete old snapshots which belong to terminated instances and/or deleted EBS volumes.\n\n# Change Log #\n* Rev 1\n  * Initial release\n* Rev 2\n  * Replaced Apache with Nginx\n  * Running PHP5 FPM application server rather than a PHP module for Apache or Nginx\n  * Dropped incomplete support for Zend Framework\n  * Dropped Gitosis as a default, since I imagine I'm the only person using it, and it's a bit out of place\n  * Added Alerts for critical systems and failure/limp conditions\n  * New MCI which includes RightLink 5.6.28 and creates an 8GB root partition rather than 10GB\n  * Added ability to connect this server with the [Opscode](http://www.opscode.com/platform/) Chef platform to further customize your instance\n\n\n# TODO #\n* Setup a default vhost\n  * Including an SSL vhost that hosts various tools like phpmyadmin and a management tool for email configuration etc.\n* More alerts\n  * Postfix high load\n  * MySQL high load\n  * Low memory\n  * Nginx high load\n* Reconsider ZendFramework support\n* Enable gitweb (probably within aforementioned SSL vhost)\n* Installation/Deployment/management recipes for Drupal? Maybe?\n* Full and proper email stack (local delivery, pop3, imap, ldap configuration)","name":"LNMP & Email Vhosting All-In-One with Nginx, PHP5-FPM, MySQL 5.1, and Postfix","created_at":"2011/12/08 18:18:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2012/02/28 23:03:21 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Rev 1 - Initial Commit","time":"2012/02/28 22:36:16 +0000","user":"ryan.geyer@rightscale.com"},"description":null,"name":"CloudStack Management Server Single-Node","created_at":"2012/02/28 23:03:19 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Initial Commit","updated_at":"2012/02/28 23:03:21 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"time":"2012/02/28 22:56:22 +0000","text":"Initial Commit","user":"ryan.geyer@rightscale.com"},"description":"Configures a CloudStack 2.2.13 Single Node Management Server.  Based on the RightScale Database Manager for MySQL 5.1.\n\nThis template also enables an OpenVPN server which uses a self signed SSL/TLS certificate for encryption and authentication.  You can fetch a client configuration and key pair with the following;\n\nscp root@hostname-or-ip-of-this-server:/etc/openvpn/keys/remote.tar.gz .\n\nThe default URL for the CloudStack management dashboard is;\nhttp://hostname-or-ip-of-this-server:8080/client\n\nThe Default login is;\nadmin/password\n\nSee [the source cookbook](https://github.com/rgeyer/cookbooks_linux/tree/master/cookbooks/cloudstack) for more information.\n\n------------------ Original Right Scale Database Manager Description -------------------------\n\nThe ServerTemplate supports multiple clouds, using either instance-based storage or attachable volumes. Instance-based snapshot backups are automatically uploaded to your choice of remote object storage (Amazon S3 or Rackspace Cloud Files). It also includes iptables management for clouds that do not have firewall services.\n\n* Master or slave roles.\n* Uses attachable volumes or instance-based LVM volumes for primary backup.\n* Supports a secondary, disaster-recovery backup to S3 or Cloud Files remote object stores.\n* Support for striping of external volumes for faster database performance.\n* Continuous snapshot backups using a grandfather-father-son paradigm (on clouds with volume support).\n* Assisted database restoration, including stripe re-creation.\n* Provides scripts for master to slave fail-over, restoration of master, and more.\n* Choice of DNS providers (DNS Made Easy, DynDNS, AWS Route53).\n* iptables management within a three-tier scalable web architecture for clouds that do not have firewall services.\n* Pre-configured monitoring and alerts.\n\nSee the [Database Manager for MySQL 5.1 (Chef) Database Setup](http://support.rightscale.com/12345-Tutorials/12345-AWS/12345-Website_Edition/Database_Setups/12345.1_MySQL_Setup/Create_a_MySQL-EBS_Database_Setup/Database_Manager_for_MySQL_5.1_(Chef\\)_Database_Setup) guide to get started.\n\nSupported compute clouds:\n\n     * Amazon Web Services EC2 with EBS Volume Snapshot Support\n     * Citrix CloudStack KVM/Xen/XenServer with Volume Snapshot Support\n     * Eucalyptus\n     * Rackspace\n\nSupported primary backup methods:\n\n     * Volume snapshots: AWS EC2, Citrix CloudStack, Eucalyptus\n     * Remote Object Store Upload: AWS S3, Rackspace Cloud Files\n\nNote: The snapshot backups from previous Database Managers (11H1 and older) are currently not compatible with this new Database Manager. You will have to do a manual migration of your data.","name":"CloudStack Management Server Single-Node","created_at":"2012/02/28 23:03:20 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2012/03/26 22:05:50 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"* Upgraded to CloudStack 2.2.14\n* Improved OpenVPN configuration","time":"2012/03/26 22:03:54 +0000","user":"ryan.geyer@rightscale.com"},"description":null,"name":"CloudStack Management Server Single-Node","created_at":"2012/03/26 22:05:48 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":"* Upgraded to CloudStack 2.2.14\n* Improved OpenVPN configuration","updated_at":"2012/03/26 22:05:50 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"* Upgraded to CloudStack 2.2.14\n* Improved OpenVPN configuration","time":"2012/03/26 22:04:51 +0000","user":"ryan.geyer@rightscale.com"},"description":"Configures a CloudStack 2.2.14 Single Node Management Server.  Based on the RightScale Database Manager for MySQL 5.1.\n\nThis template also enables an OpenVPN server which uses a self signed SSL/TLS certificate for encryption and authentication.  You can fetch a client configuration and key pair with the following;\n\nscp root@hostname-or-ip-of-this-server:/etc/openvpn/keys/remote.tar.gz .\n\nThe default URL for the CloudStack management dashboard is;\nhttp://hostname-or-ip-of-this-server:8080/client\n\nThe Default login is;\nadmin/password\n\nSee [the source cookbook](https://github.com/rgeyer/cookbooks_linux/tree/master/cookbooks/cloudstack) for more information.\n\n------------------ Original Right Scale Database Manager Description -------------------------\n\nThe ServerTemplate supports multiple clouds, using either instance-based storage or attachable volumes. Instance-based snapshot backups are automatically uploaded to your choice of remote object storage (Amazon S3 or Rackspace Cloud Files). It also includes iptables management for clouds that do not have firewall services.\n\n* Master or slave roles.\n* Uses attachable volumes or instance-based LVM volumes for primary backup.\n* Supports a secondary, disaster-recovery backup to S3 or Cloud Files remote object stores.\n* Support for striping of external volumes for faster database performance.\n* Continuous snapshot backups using a grandfather-father-son paradigm (on clouds with volume support).\n* Assisted database restoration, including stripe re-creation.\n* Provides scripts for master to slave fail-over, restoration of master, and more.\n* Choice of DNS providers (DNS Made Easy, DynDNS, AWS Route53).\n* iptables management within a three-tier scalable web architecture for clouds that do not have firewall services.\n* Pre-configured monitoring and alerts.\n\nSee the [Database Manager for MySQL 5.1 (Chef) Database Setup](http://support.rightscale.com/12345-Tutorials/12345-AWS/12345-Website_Edition/Database_Setups/12345.1_MySQL_Setup/Create_a_MySQL-EBS_Database_Setup/Database_Manager_for_MySQL_5.1_(Chef\\)_Database_Setup) guide to get started.\n\nSupported compute clouds:\n\n     * Amazon Web Services EC2 with EBS Volume Snapshot Support\n     * Citrix CloudStack KVM/Xen/XenServer with Volume Snapshot Support\n     * Eucalyptus\n     * Rackspace\n\nSupported primary backup methods:\n\n     * Volume snapshots: AWS EC2, Citrix CloudStack, Eucalyptus\n     * Remote Object Store Upload: AWS S3, Rackspace Cloud Files\n\nNote: The snapshot backups from previous Database Managers (11H1 and older) are currently not compatible with this new Database Manager. You will have to do a manual migration of your data.","name":"CloudStack Management Server Single-Node","created_at":"2012/03/26 22:05:49 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2012/04/25 23:00:22 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Initial Commit","time":"2012/04/25 22:48:49 +0000","user":"ryan.geyer@rightscale.com"},"description":null,"name":"RightScale Public + UOX","created_at":"2012/04/25 23:00:21 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Added Process \"uox3\" to process list for monitoring.","updated_at":"2012/04/25 23:00:22 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"time":"2012/04/25 22:59:22 +0000","text":"Added Process \"uox3\" to process list for monitoring.","user":"ryan.geyer@rightscale.com"},"description":"Stands up a single server running the UOX3 (Ultima Offline Experiment) game emulator.\n\nThe UOX3 binary runs in a screen session named \"uox3\" as the user \"uox3\", and is controlled by a SysV init script at /etc/init.d/uox3.\n\nThis ServerTemplate includes an alert which will notify the administrator if the uox3 process has ceased to run for over 5 minutes.\n\nThis ServerTemplate also includes monitors which show the current memory use, and number of online characters in the game.\n\nClient/Multi files and Shard Backups\n======================\n\nClient files can be downloaded from a ROS, and the shard files can be backed up or restored from a ROS.  \"ROS\"\nis an abbreviation for \"Remote Object Store\".\n\nCurrently supported ROS sources are;\n\n* Amazon S3\n* Rackspace CloudFiles and CloudFiles UK\n* SoftLayer Dallas, Singapore, and Amsterdam.\n\nContinuous (daily) backup of the shard files is enabled by default and can be disabled.  _Backups are not pruned automatically!_\nYou should plan to periodically clean up the shard files backups in the ROS.\n\nSince the UO Client data (*.mul files) can not be distributed, you must first install UO and create a zip file containing those files.\n\nA copy of the UO client files (the *.mul files in your game directory) are required and not distributed with this\ncookbook.  The default recipe is configured to download those files from a ROS.\n\nTo make the *.mul files available, install UO on your windows computer, then put all of the *.mul files into a zip file.\nUpload that zip file to one of the above supported ROS sources, then specify that source when launching your UOX server\nwith these recipes.","name":"Ultima Online Emulator (UOX3)","created_at":"2012/04/25 23:00:22 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2012/05/01 00:40:27 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"time":"2012/05/01 00:12:14 +0000","text":"Cloudstack 3.0.x support.","user":"ryan.geyer@rightscale.com"},"description":null,"name":"CloudStack Management Server Single-Node","created_at":"2012/05/01 00:40:25 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":"Updated to latest DBManager base.\n\nAdded CloudStack 3.0.x install support","updated_at":"2012/05/01 00:44:52 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"time":"2012/05/01 00:37:36 +0000","text":"Updated to latest DBManager base.\n\nAdded CloudStack 3.0.x install support","user":"ryan.geyer@rightscale.com"},"description":"Configures a CloudStack 2.2.14 or the latest 3.0.x Single Node Management Server.  Based on the RightScale Database Manager for MySQL 5.1.\n\nThis template also enables an OpenVPN server which uses a self signed SSL/TLS certificate for encryption and authentication.  You can fetch a client configuration and key pair with the following;\n\nscp root@hostname-or-ip-of-this-server:/etc/openvpn/keys/remote.tar.gz .\n\nThe default URL for the CloudStack management dashboard is;\nhttp://hostname-or-ip-of-this-server:8080/client\n\nThe Default login is;\nadmin/password\n\nSee [the source cookbook](https://github.com/rgeyer/cookbooks_linux/tree/master/cookbooks/cloudstack) for more information.\n\n------------------ Original Right Scale Database Manager Description -------------------------\n\nConfigures a MySQL 5.1 database server. This ServerTemplate provides a high-availability master/slave database configuration that can be used as the backbone for a variety of applications and workloads. \n\nThe ServerTemplate supports multiple clouds, using either instance-based storage or attachable volumes. Instance-based snapshot backups are automatically uploaded to your choice of remote object storage (Amazon S3 or Rackspace Cloud Files). It also includes iptables management for clouds that do not have firewall services.\n\nFor the latest version of MySQL, see Database Manager for MySQL 5.5\n\n__Key Features:__\n* Master or slave roles.\n* Uses attachable volumes or instance-based LVM volumes for primary backup.\n* Supports a secondary, disaster-recovery backup to S3 or Cloud Files remote object stores.\n* Support for striping of external volumes for faster database performance.\n* Continuous snapshot backups using a grandfather-father-son paradigm (on clouds with volume support).\n* Assisted database restoration, including stripe re-creation.\n* Provides scripts for master to slave fail-over, restoration of master, and more.\n* Choice of DNS providers (DNS Made Easy, DynDNS, AWS Route53).\n* iptables management within a three-tier scalable web architecture for clouds that do not have firewall services.\n* Pre-configured monitoring and alerts.\n\n__Related ServerTemplates:__  \nLoad Balancer  \nTomcat App Server  \nApache-Rails-Passenger App Server  \nPHP App Server\n\n__Release Notes:__  \n[Database Manager for MySQL 5.1 Release Notes](http://support.rightscale.com/12345-Release_Notes/ServerTemplates_and_RightImages/12345-03-26#Database_Manager_for_MySQL_5.1)\n\n* * *\n\n__Application versions:__\n* MySQL 5.1.55\n\n__Supported compute clouds:__\n* Amazon Web Services EC2\n* Citrix CloudStack\n* IDC Frontier\n* Logicworks\n* Rackspace\n* SoftLayer\n\n__Supported backup clouds:__\n* Amazon Web Services S3\n* Rackspace CloudFiles (US and UK)\n* Softlayer Swift (Dallas, Singapore, and Amsterdam)\n\n__Supported primary backup methods:__\n* Volume snapshots: AWS EC2, Citrix CloudStack\n* Remote Object Store Upload: AWS S3, Rackspace Cloud Files, Softlayer\n\n__Supported MultiCloud Images:__\n* CentOS 5.6 - Amazon, CloudStack, IDC Frontier, Logicworks, Rackspace\n* CentOS 5.7 - SoftLayer\n* Ubuntu 10.04 - Amazon, Rackspace\n* RHEL 5.6 - Amazon\n","name":"CloudStack Management Server Single-Node","created_at":"2012/05/01 00:40:26 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":"Added SoftLayer image.  Pruned 32bit and KVM/VMWare images","updated_at":"2012/05/01 00:45:22 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"Added SoftLayer image.  Pruned 32bit and KVM/VMWare images","time":"2012/05/01 00:44:33 +0000","user":"ryan.geyer@rightscale.com"},"description":"Configures a CloudStack 2.2.14 or the latest 3.0.x Single Node Management Server.  Based on the RightScale Database Manager for MySQL 5.1.\n\nThis template also enables an OpenVPN server which uses a self signed SSL/TLS certificate for encryption and authentication.  You can fetch a client configuration and key pair with the following;\n\nscp root@hostname-or-ip-of-this-server:/etc/openvpn/keys/remote.tar.gz .\n\nThe default URL for the CloudStack management dashboard is;\nhttp://hostname-or-ip-of-this-server:8080/client\n\nThe Default login is;\nadmin/password\n\nSee [the source cookbook](https://github.com/rgeyer/cookbooks_linux/tree/master/cookbooks/cloudstack) for more information.\n\n------------------ Original Right Scale Database Manager Description -------------------------\n\nConfigures a MySQL 5.1 database server. This ServerTemplate provides a high-availability master/slave database configuration that can be used as the backbone for a variety of applications and workloads. \n\nThe ServerTemplate supports multiple clouds, using either instance-based storage or attachable volumes. Instance-based snapshot backups are automatically uploaded to your choice of remote object storage (Amazon S3 or Rackspace Cloud Files). It also includes iptables management for clouds that do not have firewall services.\n\nFor the latest version of MySQL, see Database Manager for MySQL 5.5\n\n__Key Features:__\n* Master or slave roles.\n* Uses attachable volumes or instance-based LVM volumes for primary backup.\n* Supports a secondary, disaster-recovery backup to S3 or Cloud Files remote object stores.\n* Support for striping of external volumes for faster database performance.\n* Continuous snapshot backups using a grandfather-father-son paradigm (on clouds with volume support).\n* Assisted database restoration, including stripe re-creation.\n* Provides scripts for master to slave fail-over, restoration of master, and more.\n* Choice of DNS providers (DNS Made Easy, DynDNS, AWS Route53).\n* iptables management within a three-tier scalable web architecture for clouds that do not have firewall services.\n* Pre-configured monitoring and alerts.\n\n__Related ServerTemplates:__  \nLoad Balancer  \nTomcat App Server  \nApache-Rails-Passenger App Server  \nPHP App Server\n\n__Release Notes:__  \n[Database Manager for MySQL 5.1 Release Notes](http://support.rightscale.com/12345-Release_Notes/ServerTemplates_and_RightImages/12345-03-26#Database_Manager_for_MySQL_5.1)\n\n* * *\n\n__Application versions:__\n* MySQL 5.1.55\n\n__Supported compute clouds:__\n* Amazon Web Services EC2\n* Citrix CloudStack\n* IDC Frontier\n* Logicworks\n* Rackspace\n* SoftLayer\n\n__Supported backup clouds:__\n* Amazon Web Services S3\n* Rackspace CloudFiles (US and UK)\n* Softlayer Swift (Dallas, Singapore, and Amsterdam)\n\n__Supported primary backup methods:__\n* Volume snapshots: AWS EC2, Citrix CloudStack\n* Remote Object Store Upload: AWS S3, Rackspace Cloud Files, Softlayer\n\n__Supported MultiCloud Images:__\n* CentOS 5.6 - Amazon, CloudStack, IDC Frontier, Logicworks, Rackspace\n* CentOS 5.7 - SoftLayer\n* Ubuntu 10.04 - Amazon, Rackspace\n* RHEL 5.6 - Amazon\n","name":"CloudStack Management Server Single-Node","created_at":"2012/05/01 00:45:21 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":4,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2012/07/24 23:50:07 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Initial Commit","time":"2012/07/24 23:08:15 +0000","user":"ryan.geyer@rightscale.com"},"description":null,"name":"RightScale (v12.11.0-LTS) + LNMP","created_at":"2012/07/24 23:50:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":1,"actions":[{"rel":"import"}]},{"revision_notes":"Rev 4 - RightScale v12.11.0-LTS assets and more..","updated_at":"2012/07/30 19:58:15 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"time":"2012/07/24 23:42:43 +0000","text":"Rev 4 - RightScale v12.11.0-LTS assets and more..","user":"ryan.geyer@rightscale.com"},"description":"# Description #\nThis is an All-In-One (AIO) server for hosting PHP based web sites/applications, as well as email for one or many domain names (virtual hosting).\n\n## Total Cost of Ownership ##\nThis ServerTemplate is designed to run within the confines of a [t1.micro](http://aws.amazon.com/ec2/instance-types/) EC2 instance.  A t1.micro instance requires that you use an EBS volume to store the operating system.  The MultiCloud Image this ServerTemplate uses automatically creates an 8GB EBS volume for this purpose.\n\nThis server template requires one additional EBS volume for storing configuration and application data, the size of which will vary based on what you're running.  The default size for this partition is 2GB.  Combined with the 8GB root partition the total EBS footprint is exactly 10GB, the maximum for the AWS free tier.\n\nWhen you first sign up for AWS you can take advantage of their [free tier](http://aws.amazon.com/free/) for all services for one year.\n\nWhile using this server template I've averaged $0.12 per month between EIP data transfer costs, and the additional EBS volume.\n\nAfter one year when the free tier expires, you can expect to spend under $15 per month if you pay for a t1.micro reserved instance, broken down thusly.\n\n* t1.micro reservation (heavy usage) for 1 year $62 ($5.17/mo but billed once at the beginning)\n* 730hr t1.micro usage @$0.005/hr (Reserved cost in US-EAST cloud) $3.65/mo\n* 8GB EBS Volume $0.80/mo\n* 2GB EBS Volume $0.20/mo\n* Snapshot Storage is variable depending on how you configure your retention policy.  Snapshots are incremental and store only the delta, so actual storage costs are quite low.\n\nThat totals out to $9.82/mo, which leaves $5.18 (out of $15) for data transfer, I/O requests and maybe some S3 storage.\n\nAs I personally run this more, I'll be able to give some more real world data, rather than just estimates.  The point though, is that this is dirt cheap given the control you have!\n\n## LNMP Virtual Hosting ##\nThe web hosting environment is a full LNMP stack consisting of;\n\n* Linux - CentOS 5.8\n* Nginx - 1.2.2\n* MySQL - 5.1.55-community\n* PHP - 5.3.6\n\n## Email Virtual Hosting ##\nIn addition to the LNMP stack, a Postfix server is installed and configured for virtual hosting of one or many email domains.  Currently, the postfix server is configured to relay email for configured email addresses (more information on that below) to one or more other email addresses.  I use this to accept email for a domain, and effectively \"forward\" it to my gmail account where I manage all of my email.\n\n# Usage #\n\n## Prerequisites ##\n\n### Elastic IP ###\nIt is *HIGHLY* recommended that you setup an Elastic IP for your server instance if you run this on AWS.  This will make things like vertical scaling and disaster recovery easier.\n\nIn clouds besides AWS, or in absence of an Elastic IP you'll just have to make DNS changes and wait for those changes to propagate.\n\nAlso, if you're going to be serious about running an email server, using an EIP is the only way to go so you don't get blacklisted etc.  Setup an EIP, then make sure you fill out [this form](https://aws-portal.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request) to setup a reverse DNS record for your hostname (like mail.yourdomain.com) to your EIP.  You can read about why this is important [here](http://www.simpledns.com/kb.aspx?kbid=1052)\n\n### Security Groups ###\nYou'll need to be able to communicate with your server from the interwebs.  This means you'll need to open some ports in one or more security groups, and add your server instance to those security groups.\n\nIn clouds which do not support security groups set the \"Firewall\" input to enabled, and all inbound access (besides the required ports listed below) will be blocked.\n\nAs a best practice, try to avoid making all of your changes to the \"default\" security group.  It's also better if you put the ports for each service in it's own security group, though just one security group which opens all ports for this server instance is probably okay too.  Here are the ports that are required to be able to communicate with this server.\n\n* SSH - TCP:22\n* SMTP - TCP:25\n* HTTP - TCP:80\n* HTTPS - TCP:443\n\n## Launching for the first time ##\nIf you've just imported this ServerTemplate from the library, here's what you need to know to get started.\n\n### Inputs ###\n* Database Admin Password\n\n  Pick a secure password for the database administrator.  The default administrator username is \"administrator\".  It's possible that you'll never need to use these credentials since the Chef recipes set everything up for you, but it's good to have in case of emergency or for administrative tasks not covered in an operational script etc.\n\n* Postfix MySQL Database Password\n\n  Pick a secure password for the user account that postfix will use to access the MySQL database.  Did I mention that Postfix configuration information is stored in MySQL?  I promise, I'll explain later.\n* Total Volume Size (1)\n\n  This server stores all of the data which needs to be persistent either on a separate attached storage volume, or on an LVM partition of your ephemeral storage to ease backups, disaster recovery, and vertical scaling.  Specify a volume size here that makes sense for the data you're storing, including MySQL databases and your web site/application html and code files.  **NOTE**: The default is 2GB\n\n* Backup Lineage (1)\n\nFor the attached volume, and for the continuous backups a lineage needs to be specified.  This is effectively a name for the data backup, feel free to specify anything for this.  For all of the volume management stuff I'm making heavy use of the RightScale \"Storage Toolbox\", and this input comes from those tools.  Take a peek at the documentation and runbook for the \"Storage Toolbox\" [here](http://support.rightscale.com/12345-Tutorials/Storage_Toolbox/Storage_Toolbox_Runbook)\n\n* Web Server Hostname\n\nSome basic tools will get installed and hosted for this server on a particular hostname.  These are things like phpmyadmin, and (hopefully, eventually) some web UI tools for managing your server.  You can specify the hostname you want this to appear on.  I recommend that you use a hostname specific to the management of this server, like tools.domain.com etc.\n\nIf you're in a hurry, and just wanted to get this up and running quickly, that's all you'll need to know.\n\n## Disaster Recovery or Vertical Scaling ##\nAs mentioned, all of the configuration and application data for all the services is stored on an attached or LVM managed volume.  That volume has a snapshot taken of it once per day.  Those snapshots can be used to start a new instance of this server with the data and configuration exactly as it was at that point in time.\n\nThis is useful for vertical scaling.  I.E. Using a bigger, badder instance type to manage more traffic.  It's also useful for disaster recovery.\n\nTo bring up a new instance from a snapshot, these are the steps.\n\n1. Find the AWS ID of the latest snapshot for your data volume\n  * Alternate first step is to create a snapshot \"right now\" by running the \"block_device::do_primary_backup\" or \"block_device::do_secondary_backup\" recipe on the current instance.\n2. Add a new server to your deployment using this ServerTemplate\n3. Click \"Launch\" and set all of your inputs to the desired values\n4. Launch the new instance\n5. Run the \"nginx::setup_vhost\" or \"app_wordpress::deploy\" (which ever is appropriate) once for each vhosted domain this server answers for.\n6. Verify web and email vhosts are working properly (change /etc/hosts file to point to new IP etc)\n7. Change your DNS records from the IP of the old instance, to the new one\n  * **Pro Tip**: Or, if you're using an Elastic IP, just reassign the the EIP to the new instance\n8. Once DNS records are propagated, or EIP remap is finished, decommission old instance\n9. Clean up volume and snapshots of old instance\n  * See \"Managing Artifacts\" below\n\n# Configuring Services #\n\n## Wordpress Powered Website ##\nIf you want to host a Wordpress powered website, you're only a few inputs and clicks away\n\nInputs\n1. MySQL Database Password for this Wordpress instance\n  Pick a secure password which Wordpress will use to access the database.  The Wordpress configuration file will automatically be created with this information\n2. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text missing in this field.\n3. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\n## Website ##\nIf you want to host a website that's just static HTML, or a mix of HTML and some PHP files, you can set it up by running the \"nginx::setup_vhost\" script.\n\nThis script takes only two inputs.\n1. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the field empty.\n2. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\nRunning the script will create the necessary configuration file(s) for Apache2.  The root directory for the new website will be /mnt/storage/www/<VHOST FQDN>/htdocs.  Put the your web files there and you're all set!\n\n## Postfix Email Relaying ##\nThe configuration for postfix is stored in a MySQL database, thus the input attributes for a postfix MySQL user, database, and password.  Right now, you'll need to get right into the MySQL commandline in order to manipulate the configuration but there are plans to make this much more user friendly in the future.\n\n### Virtual Domains ###\nThe first thing you'll need to do is tell postfix which domain names it'll be handling email for.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each domain you want to handle email for, run the following MySQL query.\n\n_INSERT INTO transport (domain,destination) VALUES ('yourdomain.com','virtual:')_\n\nWhere 'yourdomain.com' is the domain name you want to handle email for.\n\n### Virtual User Aliases ###\nOnce you've defined the domain names that you'll be handling email for, you'll want to setup which email addresses you'll be accepting email for, and what email address to relay them to.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each email address you want to accept email for, run the following MySQL query.\n\n_INSERT INTO virtual (email,destination) VALUES ('you@yourdomain.com','you@gmail.com')_\n\nThe first value is the email address which your server will accept email for.  The 'yourdomain.com' must already be in transport table, which you would have added in the \"Virtual Domains\" section above.\n\nThe second value is the email address you want any emails sent to the 'you@yourdomain.com' relayed to.  It's just that easy!\n\nYou can specify many different email addresses to be relayed to the same destination address.  You can also specify a \"catchall\" destination for a domain by excluding the user.  I.E. Supplying '@yourdomain.com' for the first value, and 'you@gmail.com' as the second value would route any email sent to any address @yourdomain.com to your gmail address.  It's not advisable, but it can be done.\n\n# Managing Artifacts #\nWe've mentioned a couple times above that this server uses attachable volumes (where available) to store configuration and application data.  The creation of that volume, and the creation of the snapshots for backups is fully automated.  The number of snapshots for the current instance is even kept in check by the backup policy inputs.\n\nHowever, when you launch a new instance to replace an existing one, some artifacts get left behind which will need to be manually cleaned up.  Below you'll find information on what things to look out for.  Automating this cleanup is VERY high on my priority list for enhancements of this ServerTemplate.\n\n## Volumes ##\nWhen you terminate a running instance of this server template, the automatically created volume is not deleted.  So after performing the steps from the \"Disaster Recovery or Vertical Scaling\" section above, you'll want to look at the volumes in the same cloud as the terminated instance, and go ahead and delete it.\n\nYou may want to verify that you have a current snapshot of the volume first, though you would probably have already done that before launching a new instance and terminating the old one.\n\n## Snapshots ##\nSnapshots of the old volume associated with a terminated instance are not automatically deleted by the backup script based.  This is because the snapshots are not associated with the new volume or instance, so the script has no way of knowing that they are related.\n\nAs a result, you'll want to delete old snapshots which belong to terminated instances and/or deleted volumes.\n\n# Change Log #\n* Rev 1\n  * Initial release\n* Rev 2\n  * Replaced Apache with Nginx\n  * Running PHP5 FPM application server rather than a PHP module for Apache or Nginx\n  * Dropped incomplete support for Zend Framework\n  * Dropped Gitosis as a default, since I imagine I'm the only person using it, and it's a bit out of place\n  * Added Alerts for critical systems and failure/limp conditions\n  * New MCI which includes RightLink 5.6.28 and creates an 8GB root partition rather than 10GB\n  * Added ability to connect this server with the [Opscode](http://www.opscode.com/platform/) Chef platform to further customize your instance\n* Rev 4\n  * Updated to latest RightScale assets (RightLink 5.8, Storage Toolbox, etc)\n  * Added a default vhost with phpmyadmin\n\n\n# TODO #\n* Setup a default vhost\n  * Including an SSL vhost that hosts various tools like phpmyadmin and a management tool for email configuration etc.\n    * This is partially done, in that phpmyadmin is deployed in a default vhost that redirects to SSL\n* More alerts\n  * Postfix high load\n  * MySQL high load\n  * Low memory\n  * Nginx high load\n* Reconsider ZendFramework support\n* Enable gitweb (probably within aforementioned SSL vhost)\n* Full and proper email stack (local delivery, pop3, imap, ldap configuration)","name":"Wordpress & Email All-In-One","created_at":"2012/07/24 23:50:05 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":4,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2012/07/30 19:58:02 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Rev 2 - Use a public copy of the rightscale_cookbooks repo","time":"2012/07/30 19:54:37 +0000","user":"ryan.geyer@rightscale.com"},"description":null,"name":"RightScale (v12.11.0-LTS) + LNMP","created_at":"2012/07/30 19:57:59 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":2,"actions":[{"rel":"import"}]},{"revision_notes":"Rev 5 - Use Rev 2 of the RepoPath, which includes a public version of the rightscale_cookbooks repo suitable for public consumption. :)","updated_at":"2012/08/06 21:59:28 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"time":"2012/07/30 19:57:35 +0000","text":"Rev 5 - Use Rev 2 of the RepoPath, which includes a public version of the rightscale_cookbooks repo suitable for public consumption. :)","user":"ryan.geyer@rightscale.com"},"description":"# Description #\nThis is an All-In-One (AIO) server for hosting PHP based web sites/applications, as well as email for one or many domain names (virtual hosting).\n\n## Total Cost of Ownership ##\nThis ServerTemplate is designed to run within the confines of a [t1.micro](http://aws.amazon.com/ec2/instance-types/) EC2 instance.  A t1.micro instance requires that you use an EBS volume to store the operating system.  The MultiCloud Image this ServerTemplate uses automatically creates an 8GB EBS volume for this purpose.\n\nThis server template requires one additional EBS volume for storing configuration and application data, the size of which will vary based on what you're running.  The default size for this partition is 2GB.  Combined with the 8GB root partition the total EBS footprint is exactly 10GB, the maximum for the AWS free tier.\n\nWhen you first sign up for AWS you can take advantage of their [free tier](http://aws.amazon.com/free/) for all services for one year.\n\nWhile using this server template I've averaged $0.12 per month between EIP data transfer costs, and the additional EBS volume.\n\nAfter one year when the free tier expires, you can expect to spend under $15 per month if you pay for a t1.micro reserved instance, broken down thusly.\n\n* t1.micro reservation (heavy usage) for 1 year $62 ($5.17/mo but billed once at the beginning)\n* 730hr t1.micro usage @$0.005/hr (Reserved cost in US-EAST cloud) $3.65/mo\n* 8GB EBS Volume $0.80/mo\n* 2GB EBS Volume $0.20/mo\n* Snapshot Storage is variable depending on how you configure your retention policy.  Snapshots are incremental and store only the delta, so actual storage costs are quite low.\n\nThat totals out to $9.82/mo, which leaves $5.18 (out of $15) for data transfer, I/O requests and maybe some S3 storage.\n\nAs I personally run this more, I'll be able to give some more real world data, rather than just estimates.  The point though, is that this is dirt cheap given the control you have!\n\n## LNMP Virtual Hosting ##\nThe web hosting environment is a full LNMP stack consisting of;\n\n* Linux - CentOS 5.8\n* Nginx - 1.2.2\n* MySQL - 5.1.55-community\n* PHP - 5.3.6\n\n## Email Virtual Hosting ##\nIn addition to the LNMP stack, a Postfix server is installed and configured for virtual hosting of one or many email domains.  Currently, the postfix server is configured to relay email for configured email addresses (more information on that below) to one or more other email addresses.  I use this to accept email for a domain, and effectively \"forward\" it to my gmail account where I manage all of my email.\n\n# Usage #\n\n## Prerequisites ##\n\n### Elastic IP ###\nIt is *HIGHLY* recommended that you setup an Elastic IP for your server instance if you run this on AWS.  This will make things like vertical scaling and disaster recovery easier.\n\nIn clouds besides AWS, or in absence of an Elastic IP you'll just have to make DNS changes and wait for those changes to propagate.\n\nAlso, if you're going to be serious about running an email server, using an EIP is the only way to go so you don't get blacklisted etc.  Setup an EIP, then make sure you fill out [this form](https://aws-portal.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request) to setup a reverse DNS record for your hostname (like mail.yourdomain.com) to your EIP.  You can read about why this is important [here](http://www.simpledns.com/kb.aspx?kbid=1052)\n\n### Security Groups ###\nYou'll need to be able to communicate with your server from the interwebs.  This means you'll need to open some ports in one or more security groups, and add your server instance to those security groups.\n\nIn clouds which do not support security groups set the \"Firewall\" input to enabled, and all inbound access (besides the required ports listed below) will be blocked.\n\nAs a best practice, try to avoid making all of your changes to the \"default\" security group.  It's also better if you put the ports for each service in it's own security group, though just one security group which opens all ports for this server instance is probably okay too.  Here are the ports that are required to be able to communicate with this server.\n\n* SSH - TCP:22\n* SMTP - TCP:25\n* HTTP - TCP:80\n* HTTPS - TCP:443\n\n## Launching for the first time ##\nIf you've just imported this ServerTemplate from the library, here's what you need to know to get started.\n\n### Inputs ###\n* Database Admin Password\n\n  Pick a secure password for the database administrator.  The default administrator username is \"administrator\".  It's possible that you'll never need to use these credentials since the Chef recipes set everything up for you, but it's good to have in case of emergency or for administrative tasks not covered in an operational script etc.\n\n* Postfix MySQL Database Password\n\n  Pick a secure password for the user account that postfix will use to access the MySQL database.  Did I mention that Postfix configuration information is stored in MySQL?  I promise, I'll explain later.\n* Total Volume Size (1)\n\n  This server stores all of the data which needs to be persistent either on a separate attached storage volume, or on an LVM partition of your ephemeral storage to ease backups, disaster recovery, and vertical scaling.  Specify a volume size here that makes sense for the data you're storing, including MySQL databases and your web site/application html and code files.  **NOTE**: The default is 2GB\n\n* Backup Lineage (1)\n\nFor the attached volume, and for the continuous backups a lineage needs to be specified.  This is effectively a name for the data backup, feel free to specify anything for this.  For all of the volume management stuff I'm making heavy use of the RightScale \"Storage Toolbox\", and this input comes from those tools.  Take a peek at the documentation and runbook for the \"Storage Toolbox\" [here](http://support.rightscale.com/12345-Tutorials/Storage_Toolbox/Storage_Toolbox_Runbook)\n\n* Web Server Hostname\n\nSome basic tools will get installed and hosted for this server on a particular hostname.  These are things like phpmyadmin, and (hopefully, eventually) some web UI tools for managing your server.  You can specify the hostname you want this to appear on.  I recommend that you use a hostname specific to the management of this server, like tools.domain.com etc.\n\nIf you're in a hurry, and just wanted to get this up and running quickly, that's all you'll need to know.\n\n## Disaster Recovery or Vertical Scaling ##\nAs mentioned, all of the configuration and application data for all the services is stored on an attached or LVM managed volume.  That volume has a snapshot taken of it once per day.  Those snapshots can be used to start a new instance of this server with the data and configuration exactly as it was at that point in time.\n\nThis is useful for vertical scaling.  I.E. Using a bigger, badder instance type to manage more traffic.  It's also useful for disaster recovery.\n\nTo bring up a new instance from a snapshot, these are the steps.\n\n1. Find the AWS ID of the latest snapshot for your data volume\n  * Alternate first step is to create a snapshot \"right now\" by running the \"block_device::do_primary_backup\" or \"block_device::do_secondary_backup\" recipe on the current instance.\n2. Add a new server to your deployment using this ServerTemplate\n3. Click \"Launch\" and set all of your inputs to the desired values\n4. Launch the new instance\n5. Run the \"nginx::setup_vhost\" or \"app_wordpress::deploy\" (which ever is appropriate) once for each vhosted domain this server answers for.\n6. Verify web and email vhosts are working properly (change /etc/hosts file to point to new IP etc)\n7. Change your DNS records from the IP of the old instance, to the new one\n  * **Pro Tip**: Or, if you're using an Elastic IP, just reassign the the EIP to the new instance\n8. Once DNS records are propagated, or EIP remap is finished, decommission old instance\n9. Clean up volume and snapshots of old instance\n  * See \"Managing Artifacts\" below\n\n# Configuring Services #\n\n## Wordpress Powered Website ##\nIf you want to host a Wordpress powered website, you're only a few inputs and clicks away\n\nInputs\n1. MySQL Database Password for this Wordpress instance\n  Pick a secure password which Wordpress will use to access the database.  The Wordpress configuration file will automatically be created with this information\n2. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text missing in this field.\n3. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\n## Website ##\nIf you want to host a website that's just static HTML, or a mix of HTML and some PHP files, you can set it up by running the \"nginx::setup_vhost\" script.\n\nThis script takes only two inputs.\n1. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the field empty.\n2. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\nRunning the script will create the necessary configuration file(s) for Apache2.  The root directory for the new website will be /mnt/storage/www/<VHOST FQDN>/htdocs.  Put the your web files there and you're all set!\n\n## Postfix Email Relaying ##\nThe configuration for postfix is stored in a MySQL database, thus the input attributes for a postfix MySQL user, database, and password.  Right now, you'll need to get right into the MySQL commandline in order to manipulate the configuration but there are plans to make this much more user friendly in the future.\n\n### Virtual Domains ###\nThe first thing you'll need to do is tell postfix which domain names it'll be handling email for.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each domain you want to handle email for, run the following MySQL query.\n\n_INSERT INTO transport (domain,destination) VALUES ('yourdomain.com','virtual:')_\n\nWhere 'yourdomain.com' is the domain name you want to handle email for.\n\n### Virtual User Aliases ###\nOnce you've defined the domain names that you'll be handling email for, you'll want to setup which email addresses you'll be accepting email for, and what email address to relay them to.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each email address you want to accept email for, run the following MySQL query.\n\n_INSERT INTO virtual (email,destination) VALUES ('you@yourdomain.com','you@gmail.com')_\n\nThe first value is the email address which your server will accept email for.  The 'yourdomain.com' must already be in transport table, which you would have added in the \"Virtual Domains\" section above.\n\nThe second value is the email address you want any emails sent to the 'you@yourdomain.com' relayed to.  It's just that easy!\n\nYou can specify many different email addresses to be relayed to the same destination address.  You can also specify a \"catchall\" destination for a domain by excluding the user.  I.E. Supplying '@yourdomain.com' for the first value, and 'you@gmail.com' as the second value would route any email sent to any address @yourdomain.com to your gmail address.  It's not advisable, but it can be done.\n\n# Managing Artifacts #\nWe've mentioned a couple times above that this server uses attachable volumes (where available) to store configuration and application data.  The creation of that volume, and the creation of the snapshots for backups is fully automated.  The number of snapshots for the current instance is even kept in check by the backup policy inputs.\n\nHowever, when you launch a new instance to replace an existing one, some artifacts get left behind which will need to be manually cleaned up.  Below you'll find information on what things to look out for.  Automating this cleanup is VERY high on my priority list for enhancements of this ServerTemplate.\n\n## Volumes ##\nWhen you terminate a running instance of this server template, the automatically created volume is not deleted.  So after performing the steps from the \"Disaster Recovery or Vertical Scaling\" section above, you'll want to look at the volumes in the same cloud as the terminated instance, and go ahead and delete it.\n\nYou may want to verify that you have a current snapshot of the volume first, though you would probably have already done that before launching a new instance and terminating the old one.\n\n## Snapshots ##\nSnapshots of the old volume associated with a terminated instance are not automatically deleted by the backup script based.  This is because the snapshots are not associated with the new volume or instance, so the script has no way of knowing that they are related.\n\nAs a result, you'll want to delete old snapshots which belong to terminated instances and/or deleted volumes.\n\n# Change Log #\n* Rev 1\n  * Initial release\n* Rev 2\n  * Replaced Apache with Nginx\n  * Running PHP5 FPM application server rather than a PHP module for Apache or Nginx\n  * Dropped incomplete support for Zend Framework\n  * Dropped Gitosis as a default, since I imagine I'm the only person using it, and it's a bit out of place\n  * Added Alerts for critical systems and failure/limp conditions\n  * New MCI which includes RightLink 5.6.28 and creates an 8GB root partition rather than 10GB\n  * Added ability to connect this server with the [Opscode](http://www.opscode.com/platform/) Chef platform to further customize your instance\n* Rev 4\n  * Updated to latest RightScale assets (RightLink 5.8, Storage Toolbox, etc)\n  * Added a default vhost with phpmyadmin\n* Rev 5\n  * Changes to Chef repository to allow public access\n\n\n# TODO #\n* Setup a default vhost\n  * Including an SSL vhost that hosts various tools like phpmyadmin and a management tool for email configuration etc.\n    * This is partially done, in that phpmyadmin is deployed in a default vhost that redirects to SSL\n* More alerts\n  * Postfix high load\n  * MySQL high load\n  * Low memory\n  * Nginx high load\n* Reconsider ZendFramework support\n* Enable gitweb (probably within aforementioned SSL vhost)\n* Full and proper email stack (local delivery, pop3, imap, ldap configuration)","name":"Wordpress & Email All-In-One","created_at":"2012/07/30 19:58:00 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":5,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2012/08/06 21:59:07 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Rev3: Some rightscale_tools updates for EBS backed instances.","time":"2012/08/06 21:57:14 +0000","user":"ryan.geyer@rightscale.com"},"description":null,"name":"RightScale (v12.11.0-LTS) + LNMP","created_at":"2012/08/06 21:59:04 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":3,"actions":[{"rel":"import"}]},{"revision_notes":"Rev 6 : Better defaults for Nginx, Proper support for EBS Backed instances","updated_at":"2012/08/26 05:30:29 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"time":"2012/08/06 21:58:36 +0000","text":"Rev 6 : Better defaults for Nginx, Proper support for EBS Backed instances","user":"ryan.geyer@rightscale.com"},"description":"# Description #\nThis is an All-In-One (AIO) server for hosting PHP based web sites/applications, as well as email for one or many domain names (virtual hosting).\n\n## Total Cost of Ownership ##\nThis ServerTemplate is designed to run within the confines of a [t1.micro](http://aws.amazon.com/ec2/instance-types/) EC2 instance.  A t1.micro instance requires that you use an EBS volume to store the operating system.  The MultiCloud Image this ServerTemplate uses automatically creates an 8GB EBS volume for this purpose.\n\nThis server template requires one additional EBS volume for storing configuration and application data, the size of which will vary based on what you're running.  The default size for this partition is 2GB.  Combined with the 8GB root partition the total EBS footprint is exactly 10GB, the maximum for the AWS free tier.\n\nWhen you first sign up for AWS you can take advantage of their [free tier](http://aws.amazon.com/free/) for all services for one year.\n\nWhile using this server template I've averaged $0.12 per month between EIP data transfer costs, and the additional EBS volume.\n\nAfter one year when the free tier expires, you can expect to spend under $15 per month if you pay for a t1.micro reserved instance, broken down thusly.\n\n* t1.micro reservation (heavy usage) for 1 year $62 ($5.17/mo but billed once at the beginning)\n* 730hr t1.micro usage @$0.005/hr (Reserved cost in US-EAST cloud) $3.65/mo\n* 8GB EBS Volume $0.80/mo\n* 2GB EBS Volume $0.20/mo\n* Snapshot Storage is variable depending on how you configure your retention policy.  Snapshots are incremental and store only the delta, so actual storage costs are quite low.\n\nThat totals out to $9.82/mo, which leaves $5.18 (out of $15) for data transfer, I/O requests and maybe some S3 storage.\n\nAs I personally run this more, I'll be able to give some more real world data, rather than just estimates.  The point though, is that this is dirt cheap given the control you have!\n\n## LNMP Virtual Hosting ##\nThe web hosting environment is a full LNMP stack consisting of;\n\n* Linux - CentOS 5.8\n* Nginx - 1.2.2\n* MySQL - 5.1.55-community\n* PHP - 5.3.6\n\n## Email Virtual Hosting ##\nIn addition to the LNMP stack, a Postfix server is installed and configured for virtual hosting of one or many email domains.  Currently, the postfix server is configured to relay email for configured email addresses (more information on that below) to one or more other email addresses.  I use this to accept email for a domain, and effectively \"forward\" it to my gmail account where I manage all of my email.\n\n# Usage #\n\n## Prerequisites ##\n\n### Elastic IP ###\nIt is *HIGHLY* recommended that you setup an Elastic IP for your server instance if you run this on AWS.  This will make things like vertical scaling and disaster recovery easier.\n\nIn clouds besides AWS, or in absence of an Elastic IP you'll just have to make DNS changes and wait for those changes to propagate.\n\nAlso, if you're going to be serious about running an email server, using an EIP is the only way to go so you don't get blacklisted etc.  Setup an EIP, then make sure you fill out [this form](https://aws-portal.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request) to setup a reverse DNS record for your hostname (like mail.yourdomain.com) to your EIP.  You can read about why this is important [here](http://www.simpledns.com/kb.aspx?kbid=1052)\n\n### Security Groups ###\nYou'll need to be able to communicate with your server from the interwebs.  This means you'll need to open some ports in one or more security groups, and add your server instance to those security groups.\n\nIn clouds which do not support security groups set the \"Firewall\" input to enabled, and all inbound access (besides the required ports listed below) will be blocked.\n\nAs a best practice, try to avoid making all of your changes to the \"default\" security group.  It's also better if you put the ports for each service in it's own security group, though just one security group which opens all ports for this server instance is probably okay too.  Here are the ports that are required to be able to communicate with this server.\n\n* SSH - TCP:22\n* SMTP - TCP:25\n* HTTP - TCP:80\n* HTTPS - TCP:443\n\n## Launching for the first time ##\nIf you've just imported this ServerTemplate from the library, here's what you need to know to get started.\n\n### Inputs ###\n* Database Admin Password\n\n  Pick a secure password for the database administrator.  The default administrator username is \"administrator\".  It's possible that you'll never need to use these credentials since the Chef recipes set everything up for you, but it's good to have in case of emergency or for administrative tasks not covered in an operational script etc.\n\n* Postfix MySQL Database Password\n\n  Pick a secure password for the user account that postfix will use to access the MySQL database.  Did I mention that Postfix configuration information is stored in MySQL?  I promise, I'll explain later.\n* Total Volume Size (1)\n\n  This server stores all of the data which needs to be persistent either on a separate attached storage volume, or on an LVM partition of your ephemeral storage to ease backups, disaster recovery, and vertical scaling.  Specify a volume size here that makes sense for the data you're storing, including MySQL databases and your web site/application html and code files.  **NOTE**: The default is 2GB\n\n* Backup Lineage (1)\n\nFor the attached volume, and for the continuous backups a lineage needs to be specified.  This is effectively a name for the data backup, feel free to specify anything for this.  For all of the volume management stuff I'm making heavy use of the RightScale \"Storage Toolbox\", and this input comes from those tools.  Take a peek at the documentation and runbook for the \"Storage Toolbox\" [here](http://support.rightscale.com/12345-Tutorials/Storage_Toolbox/Storage_Toolbox_Runbook)\n\n* Web Server Hostname\n\nSome basic tools will get installed and hosted for this server on a particular hostname.  These are things like phpmyadmin, and (hopefully, eventually) some web UI tools for managing your server.  You can specify the hostname you want this to appear on.  I recommend that you use a hostname specific to the management of this server, like tools.domain.com etc.\n\nIf you're in a hurry, and just wanted to get this up and running quickly, that's all you'll need to know.\n\n## Disaster Recovery or Vertical Scaling ##\nAs mentioned, all of the configuration and application data for all the services is stored on an attached or LVM managed volume.  That volume has a snapshot taken of it once per day.  Those snapshots can be used to start a new instance of this server with the data and configuration exactly as it was at that point in time.\n\nThis is useful for vertical scaling.  I.E. Using a bigger, badder instance type to manage more traffic.  It's also useful for disaster recovery.\n\nTo bring up a new instance from a snapshot, these are the steps.\n\n1. Find the AWS ID of the latest snapshot for your data volume\n  * Alternate first step is to create a snapshot \"right now\" by running the \"block_device::do_primary_backup\" or \"block_device::do_secondary_backup\" recipe on the current instance.\n2. Add a new server to your deployment using this ServerTemplate\n3. Click \"Launch\" and set all of your inputs to the desired values\n4. Launch the new instance\n5. Run the \"nginx::setup_vhost\" or \"app_wordpress::deploy\" (which ever is appropriate) once for each vhosted domain this server answers for.\n6. Verify web and email vhosts are working properly (change /etc/hosts file to point to new IP etc)\n7. Change your DNS records from the IP of the old instance, to the new one\n  * **Pro Tip**: Or, if you're using an Elastic IP, just reassign the the EIP to the new instance\n8. Once DNS records are propagated, or EIP remap is finished, decommission old instance\n9. Clean up volume and snapshots of old instance\n  * See \"Managing Artifacts\" below\n\n# Configuring Services #\n\n## Wordpress Powered Website ##\nIf you want to host a Wordpress powered website, you're only a few inputs and clicks away\n\nInputs\n1. MySQL Database Password for this Wordpress instance\n  Pick a secure password which Wordpress will use to access the database.  The Wordpress configuration file will automatically be created with this information\n2. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text missing in this field.\n3. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\n## Website ##\nIf you want to host a website that's just static HTML, or a mix of HTML and some PHP files, you can set it up by running the \"nginx::setup_vhost\" script.\n\nThis script takes only two inputs.\n1. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the field empty.\n2. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\nRunning the script will create the necessary configuration file(s) for Apache2.  The root directory for the new website will be /mnt/storage/www/<VHOST FQDN>/htdocs.  Put the your web files there and you're all set!\n\n## Postfix Email Relaying ##\nThe configuration for postfix is stored in a MySQL database, thus the input attributes for a postfix MySQL user, database, and password.  Right now, you'll need to get right into the MySQL commandline in order to manipulate the configuration but there are plans to make this much more user friendly in the future.\n\n### Virtual Domains ###\nThe first thing you'll need to do is tell postfix which domain names it'll be handling email for.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each domain you want to handle email for, run the following MySQL query.\n\n_INSERT INTO transport (domain,destination) VALUES ('yourdomain.com','virtual:')_\n\nWhere 'yourdomain.com' is the domain name you want to handle email for.\n\n### Virtual User Aliases ###\nOnce you've defined the domain names that you'll be handling email for, you'll want to setup which email addresses you'll be accepting email for, and what email address to relay them to.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each email address you want to accept email for, run the following MySQL query.\n\n_INSERT INTO virtual (email,destination) VALUES ('you@yourdomain.com','you@gmail.com')_\n\nThe first value is the email address which your server will accept email for.  The 'yourdomain.com' must already be in transport table, which you would have added in the \"Virtual Domains\" section above.\n\nThe second value is the email address you want any emails sent to the 'you@yourdomain.com' relayed to.  It's just that easy!\n\nYou can specify many different email addresses to be relayed to the same destination address.  You can also specify a \"catchall\" destination for a domain by excluding the user.  I.E. Supplying '@yourdomain.com' for the first value, and 'you@gmail.com' as the second value would route any email sent to any address @yourdomain.com to your gmail address.  It's not advisable, but it can be done.\n\n# Managing Artifacts #\nWe've mentioned a couple times above that this server uses attachable volumes (where available) to store configuration and application data.  The creation of that volume, and the creation of the snapshots for backups is fully automated.  The number of snapshots for the current instance is even kept in check by the backup policy inputs.\n\nHowever, when you launch a new instance to replace an existing one, some artifacts get left behind which will need to be manually cleaned up.  Below you'll find information on what things to look out for.  Automating this cleanup is VERY high on my priority list for enhancements of this ServerTemplate.\n\n## Volumes ##\nWhen you terminate a running instance of this server template, the automatically created volume is not deleted.  So after performing the steps from the \"Disaster Recovery or Vertical Scaling\" section above, you'll want to look at the volumes in the same cloud as the terminated instance, and go ahead and delete it.\n\nYou may want to verify that you have a current snapshot of the volume first, though you would probably have already done that before launching a new instance and terminating the old one.\n\n## Snapshots ##\nSnapshots of the old volume associated with a terminated instance are not automatically deleted by the backup script based.  This is because the snapshots are not associated with the new volume or instance, so the script has no way of knowing that they are related.\n\nAs a result, you'll want to delete old snapshots which belong to terminated instances and/or deleted volumes.\n\n# Change Log #\n* Rev 1\n  * Initial release\n* Rev 2\n  * Replaced Apache with Nginx\n  * Running PHP5 FPM application server rather than a PHP module for Apache or Nginx\n  * Dropped incomplete support for Zend Framework\n  * Dropped Gitosis as a default, since I imagine I'm the only person using it, and it's a bit out of place\n  * Added Alerts for critical systems and failure/limp conditions\n  * New MCI which includes RightLink 5.6.28 and creates an 8GB root partition rather than 10GB\n  * Added ability to connect this server with the [Opscode](http://www.opscode.com/platform/) Chef platform to further customize your instance\n* Rev 4\n  * Updated to latest RightScale assets (RightLink 5.8, Storage Toolbox, etc)\n  * Added a default vhost with phpmyadmin\n* Rev 5\n  * Changes to Chef repository to allow public access\n* Rev 6\n  * Better defaults for Nginx\n  * Proper support for EBS Backed instances\n\n\n# TODO #\n* Setup a default vhost\n  * Including an SSL vhost that hosts various tools like phpmyadmin and a management tool for email configuration etc.\n    * This is partially done, in that phpmyadmin is deployed in a default vhost that redirects to SSL\n* More alerts\n  * Postfix high load\n  * MySQL high load\n  * Low memory\n  * Nginx high load\n* Reconsider ZendFramework support\n* Enable gitweb (probably within aforementioned SSL vhost)\n* Full and proper email stack (local delivery, pop3, imap, ldap configuration)","name":"Wordpress & Email All-In-One","created_at":"2012/08/06 21:59:05 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":6,"actions":[{"rel":"import"}]},{"revision_notes":null,"updated_at":"2012/08/26 05:30:07 +0000","publisher":"Ryan Geyer","content_type":"CookbookRepoSequence","commit_message":{"text":"Fixed Postfix w/MySQL for CentOS","time":"2012/08/26 05:04:22 +0000","user":"ryan.geyer@rightscale.com"},"description":null,"name":"RightScale (v12.11.0-LTS) + LNMP","created_at":"2012/08/26 05:30:05 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":4,"actions":[{"rel":"import"}]},{"revision_notes":"  * Install postfix mysql_pgsql from centosplus on CentOS\n  * Update app_wordpress to require nginx, apache, and php5 so that recipes can be run as operational scripts\n  * Set LVM vg data size to 50% to prevent possible data corruption\n  * Remove scheduler cookbook/recipe, using block_device continuous backups instead\n  * Set max snapshots to 10.  7 Daily + 1 Weekly + 1 Monthly + 1 Yearly = 10","updated_at":"2012/08/26 05:30:07 +0000","publisher":"Ryan Geyer","content_type":"ServerTemplate","commit_message":{"text":"  * Install posfix mysql_pgsql from centosplus on CentOS\n  * Update app_wordpress to require nginx, apache, and php5 so that recipes can be run as operational scripts\n  * Set LVM vg data size to 50% to prevent possible data corruption\n  * Remove scheduler cookbook/recipe, using block_device continuous backups instead\n  * Set max snapshots to 10.  7 Daily + 1 Weekly + 1 Monthly + 1 Yearly = 10","time":"2012/08/26 05:29:06 +0000","user":"ryan.geyer@rightscale.com"},"description":"# Description #\nThis is an All-In-One (AIO) server for hosting PHP based web sites/applications, as well as email for one or many domain names (virtual hosting).\n\n## Total Cost of Ownership ##\nThis ServerTemplate is designed to run within the confines of a [t1.micro](http://aws.amazon.com/ec2/instance-types/) EC2 instance.  A t1.micro instance requires that you use an EBS volume to store the operating system.  The MultiCloud Image this ServerTemplate uses automatically creates an 8GB EBS volume for this purpose.\n\nThis server template requires one additional EBS volume for storing configuration and application data, the size of which will vary based on what you're running.  The default size for this partition is 2GB.  Combined with the 8GB root partition the total EBS footprint is exactly 10GB, the maximum for the AWS free tier.\n\nWhen you first sign up for AWS you can take advantage of their [free tier](http://aws.amazon.com/free/) for all services for one year.\n\nWhile using this server template I've averaged $0.12 per month between EIP data transfer costs, and the additional EBS volume.\n\nAfter one year when the free tier expires, you can expect to spend under $15 per month if you pay for a t1.micro reserved instance, broken down thusly.\n\n* t1.micro reservation (heavy usage) for 1 year $62 ($5.17/mo but billed once at the beginning)\n* 730hr t1.micro usage @$0.005/hr (Reserved cost in US-EAST cloud) $3.65/mo\n* 8GB EBS Volume $0.80/mo\n* 2GB EBS Volume $0.20/mo\n* Snapshot Storage is variable depending on how you configure your retention policy.  Snapshots are incremental and store only the delta, so actual storage costs are quite low.\n\nThat totals out to $9.82/mo, which leaves $5.18 (out of $15) for data transfer, I/O requests and maybe some S3 storage.\n\nAs I personally run this more, I'll be able to give some more real world data, rather than just estimates.  The point though, is that this is dirt cheap given the control you have!\n\n## LNMP Virtual Hosting ##\nThe web hosting environment is a full LNMP stack consisting of;\n\n* Linux - CentOS 5.8\n* Nginx - 1.2.2\n* MySQL - 5.1.55-community\n* PHP - 5.3.6\n\n## Email Virtual Hosting ##\nIn addition to the LNMP stack, a Postfix server is installed and configured for virtual hosting of one or many email domains.  Currently, the postfix server is configured to relay email for configured email addresses (more information on that below) to one or more other email addresses.  I use this to accept email for a domain, and effectively \"forward\" it to my gmail account where I manage all of my email.\n\n# Usage #\n\n## Prerequisites ##\n\n### Elastic IP ###\nIt is *HIGHLY* recommended that you setup an Elastic IP for your server instance if you run this on AWS.  This will make things like vertical scaling and disaster recovery easier.\n\nIn clouds besides AWS, or in absence of an Elastic IP you'll just have to make DNS changes and wait for those changes to propagate.\n\nAlso, if you're going to be serious about running an email server, using an EIP is the only way to go so you don't get blacklisted etc.  Setup an EIP, then make sure you fill out [this form](https://aws-portal.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request) to setup a reverse DNS record for your hostname (like mail.yourdomain.com) to your EIP.  You can read about why this is important [here](http://www.simpledns.com/kb.aspx?kbid=1052)\n\n### Security Groups ###\nYou'll need to be able to communicate with your server from the interwebs.  This means you'll need to open some ports in one or more security groups, and add your server instance to those security groups.\n\nIn clouds which do not support security groups set the \"Firewall\" input to enabled, and all inbound access (besides the required ports listed below) will be blocked.\n\nAs a best practice, try to avoid making all of your changes to the \"default\" security group.  It's also better if you put the ports for each service in it's own security group, though just one security group which opens all ports for this server instance is probably okay too.  Here are the ports that are required to be able to communicate with this server.\n\n* SSH - TCP:22\n* SMTP - TCP:25\n* HTTP - TCP:80\n* HTTPS - TCP:443\n\n## Launching for the first time ##\nIf you've just imported this ServerTemplate from the library, here's what you need to know to get started.\n\n### Inputs ###\n* Database Admin Password\n\n  Pick a secure password for the database administrator.  The default administrator username is \"administrator\".  It's possible that you'll never need to use these credentials since the Chef recipes set everything up for you, but it's good to have in case of emergency or for administrative tasks not covered in an operational script etc.\n\n* Postfix MySQL Database Password\n\n  Pick a secure password for the user account that postfix will use to access the MySQL database.  Did I mention that Postfix configuration information is stored in MySQL?  I promise, I'll explain later.\n* Total Volume Size (1)\n\n  This server stores all of the data which needs to be persistent either on a separate attached storage volume, or on an LVM partition of your ephemeral storage to ease backups, disaster recovery, and vertical scaling.  Specify a volume size here that makes sense for the data you're storing, including MySQL databases and your web site/application html and code files.  **NOTE**: The default is 2GB\n\n* Backup Lineage (1)\n\nFor the attached volume, and for the continuous backups a lineage needs to be specified.  This is effectively a name for the data backup, feel free to specify anything for this.  For all of the volume management stuff I'm making heavy use of the RightScale \"Storage Toolbox\", and this input comes from those tools.  Take a peek at the documentation and runbook for the \"Storage Toolbox\" [here](http://support.rightscale.com/12345-Tutorials/Storage_Toolbox/Storage_Toolbox_Runbook)\n\n* Web Server Hostname\n\nSome basic tools will get installed and hosted for this server on a particular hostname.  These are things like phpmyadmin, and (hopefully, eventually) some web UI tools for managing your server.  You can specify the hostname you want this to appear on.  I recommend that you use a hostname specific to the management of this server, like tools.domain.com etc.\n\nIf you're in a hurry, and just wanted to get this up and running quickly, that's all you'll need to know.\n\n## Disaster Recovery or Vertical Scaling ##\nAs mentioned, all of the configuration and application data for all the services is stored on an attached or LVM managed volume.  That volume has a snapshot taken of it once per day.  Those snapshots can be used to start a new instance of this server with the data and configuration exactly as it was at that point in time.\n\nThis is useful for vertical scaling.  I.E. Using a bigger, badder instance type to manage more traffic.  It's also useful for disaster recovery.\n\nTo bring up a new instance from a snapshot, these are the steps.\n\n1. Find the AWS ID of the latest snapshot for your data volume\n  * Alternate first step is to create a snapshot \"right now\" by running the \"block_device::do_primary_backup\" or \"block_device::do_secondary_backup\" recipe on the current instance.\n2. Add a new server to your deployment using this ServerTemplate\n3. Click \"Launch\" and set all of your inputs to the desired values\n4. Launch the new instance\n5. Run the \"nginx::setup_vhost\" or \"app_wordpress::deploy\" (which ever is appropriate) once for each vhosted domain this server answers for.\n6. Verify web and email vhosts are working properly (change /etc/hosts file to point to new IP etc)\n7. Change your DNS records from the IP of the old instance, to the new one\n  * **Pro Tip**: Or, if you're using an Elastic IP, just reassign the the EIP to the new instance\n8. Once DNS records are propagated, or EIP remap is finished, decommission old instance\n9. Clean up volume and snapshots of old instance\n  * See \"Managing Artifacts\" below\n\n# Configuring Services #\n\n## Wordpress Powered Website ##\nIf you want to host a Wordpress powered website, you're only a few inputs and clicks away\n\nInputs\n1. MySQL Database Password for this Wordpress instance\n  Pick a secure password which Wordpress will use to access the database.  The Wordpress configuration file will automatically be created with this information\n2. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the text missing in this field.\n3. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\n## Website ##\nIf you want to host a website that's just static HTML, or a mix of HTML and some PHP files, you can set it up by running the \"nginx::setup_vhost\" script.\n\nThis script takes only two inputs.\n1. VHOST Aliases\n  The possible hostname aliases (if any) for the vhost.  For instance to host the same content at www.yourdomain.com and yourdomain.com simply put \"yourdomain.com\" here.  Many values can be supplied, separated by spaces.  If you don't want any aliases leave the field empty.\n2. VHOST FQDN\n  The fully qualified domain name (FQDN) of the new vhost to create.  Example www.apache.org\n\nRunning the script will create the necessary configuration file(s) for Apache2.  The root directory for the new website will be /mnt/storage/www/<VHOST FQDN>/htdocs.  Put the your web files there and you're all set!\n\n## Postfix Email Relaying ##\nThe configuration for postfix is stored in a MySQL database, thus the input attributes for a postfix MySQL user, database, and password.  Right now, you'll need to get right into the MySQL commandline in order to manipulate the configuration but there are plans to make this much more user friendly in the future.\n\n### Virtual Domains ###\nThe first thing you'll need to do is tell postfix which domain names it'll be handling email for.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each domain you want to handle email for, run the following MySQL query.\n\n_INSERT INTO transport (domain,destination) VALUES ('yourdomain.com','virtual:')_\n\nWhere 'yourdomain.com' is the domain name you want to handle email for.\n\n### Virtual User Aliases ###\nOnce you've defined the domain names that you'll be handling email for, you'll want to setup which email addresses you'll be accepting email for, and what email address to relay them to.\n\nWhen connected to the server with SSH, type `mysql` to get into a mysql commandline client.  Then type `use postfix;` to select the postfix configuration database.  If you supplied a different database name for the postfix configuration, substitute that in the use command.  Then, for each email address you want to accept email for, run the following MySQL query.\n\n_INSERT INTO virtual (email,destination) VALUES ('you@yourdomain.com','you@gmail.com')_\n\nThe first value is the email address which your server will accept email for.  The 'yourdomain.com' must already be in transport table, which you would have added in the \"Virtual Domains\" section above.\n\nThe second value is the email address you want any emails sent to the 'you@yourdomain.com' relayed to.  It's just that easy!\n\nYou can specify many different email addresses to be relayed to the same destination address.  You can also specify a \"catchall\" destination for a domain by excluding the user.  I.E. Supplying '@yourdomain.com' for the first value, and 'you@gmail.com' as the second value would route any email sent to any address @yourdomain.com to your gmail address.  It's not advisable, but it can be done.\n\n# Managing Artifacts #\nWe've mentioned a couple times above that this server uses attachable volumes (where available) to store configuration and application data.  The creation of that volume, and the creation of the snapshots for backups is fully automated.  The number of snapshots for the current instance is even kept in check by the backup policy inputs.\n\nHowever, when you launch a new instance to replace an existing one, some artifacts get left behind which will need to be manually cleaned up.  Below you'll find information on what things to look out for.  Automating this cleanup is VERY high on my priority list for enhancements of this ServerTemplate.\n\n## Volumes ##\nWhen you terminate a running instance of this server template, the automatically created volume is not deleted.  So after performing the steps from the \"Disaster Recovery or Vertical Scaling\" section above, you'll want to look at the volumes in the same cloud as the terminated instance, and go ahead and delete it.\n\nYou may want to verify that you have a current snapshot of the volume first, though you would probably have already done that before launching a new instance and terminating the old one.\n\n## Snapshots ##\nSnapshots of the old volume associated with a terminated instance are not automatically deleted by the backup script based.  This is because the snapshots are not associated with the new volume or instance, so the script has no way of knowing that they are related.\n\nAs a result, you'll want to delete old snapshots which belong to terminated instances and/or deleted volumes.\n\n# Change Log #\n* Rev 1\n  * Initial release\n* Rev 2\n  * Replaced Apache with Nginx\n  * Running PHP5 FPM application server rather than a PHP module for Apache or Nginx\n  * Dropped incomplete support for Zend Framework\n  * Dropped Gitosis as a default, since I imagine I'm the only person using it, and it's a bit out of place\n  * Added Alerts for critical systems and failure/limp conditions\n  * New MCI which includes RightLink 5.6.28 and creates an 8GB root partition rather than 10GB\n  * Added ability to connect this server with the [Opscode](http://www.opscode.com/platform/) Chef platform to further customize your instance\n* Rev 4\n  * Updated to latest RightScale assets (RightLink 5.8, Storage Toolbox, etc)\n  * Added a default vhost with phpmyadmin\n* Rev 5\n  * Changes to Chef repository to allow public access\n* Rev 6\n  * Better defaults for Nginx\n  * Proper support for EBS Backed instances\n* Rev 7\n  * Install posfix mysql_pgsql from centosplus on CentOS\n  * Update app_wordpress to require nginx, apache, and php5 so that recipes can be run as operational scripts\n  * Set LVM vg data size to 50% to prevent possible data corruption\n  * Remove scheduler cookbook/recipe, using block_device continuous backups instead\n  * Set max snapshots to 10.  7 Daily + 1 Weekly + 1 Monthly + 1 Yearly = 10\n\n\n# TODO #\n* Setup a default vhost\n  * Including an SSL vhost that hosts various tools like phpmyadmin and a management tool for email configuration etc.\n    * This is partially done, in that phpmyadmin is deployed in a default vhost that redirects to SSL\n* More alerts\n  * Postfix high load\n  * MySQL high load\n  * Low memory\n  * Nginx high load\n* Reconsider ZendFramework support\n* Enable gitweb (probably within aforementioned SSL vhost)\n* Full and proper email stack (local delivery, pop3, imap, ldap configuration)","name":"Wordpress & Email All-In-One","created_at":"2012/08/26 05:30:06 +0000","links":[{"href":"/api/publications/12345","rel":"self"},{"href":"/api/publication_lineages/12345","rel":"lineage"}],"revision":7,"actions":[{"rel":"import"}]}]